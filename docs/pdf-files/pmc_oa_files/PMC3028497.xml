<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.0 20120330//EN" "JATS-archivearticle1.dtd">
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="research-article"><?properties open_access?><front><journal-meta><journal-id journal-id-type="nlm-ta">Biomed Opt Express</journal-id><journal-id journal-id-type="publisher-id">BOE</journal-id><journal-title-group><journal-title>Biomedical Optics Express</journal-title></journal-title-group><issn pub-type="epub">2156-7085</issn><publisher><publisher-name>Optical Society of America</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmid">21326634</article-id><article-id pub-id-type="pmc">3028497</article-id><article-id pub-id-type="publisher-id">137688</article-id><article-id pub-id-type="doi">10.1364/BOE.2.000044</article-id><article-categories><subj-group subj-group-type="heading"><subject>Optics of Tissue and Turbid Media</subject></subj-group></article-categories><title-group><article-title>A study on tetrahedron-based inhomogeneous Monte Carlo optical simulation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Shen</surname><given-names>Haiou</given-names></name></contrib><contrib contrib-type="author"><name><surname>Wang</surname><given-names>Ge</given-names></name><xref ref-type="corresp" rid="cor1">*</xref></contrib><aff id="aff1">School of Biomedical Engineering and Sciences, Virginia Tech, Blacksburg, VA 24061, <country>USA</country></aff></contrib-group><author-notes><corresp id="cor1"><label>*</label><email xlink:href="wangg@vt.edu">wangg@vt.edu</email></corresp></author-notes><pub-date pub-type="collection"><day>01</day><month>1</month><year>2011</year></pub-date><pub-date pub-type="epub"><day>03</day><month>12</month><year>2010</year></pub-date><pub-date pub-type="pmc-release"><day>03</day><month>12</month><year>2010</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. --><volume>2</volume><issue>1</issue><fpage>44</fpage><lpage>57</lpage><history><date date-type="received"><day>05</day><month>11</month><year>2010</year></date><date date-type="rev-recd"><day>29</day><month>11</month><year>2010</year></date><date date-type="accepted"><day>29</day><month>11</month><year>2010</year></date></history><permissions><copyright-statement>&#x000a9;2010 Optical Society
				of America</copyright-statement><copyright-year>2010</copyright-year><copyright-holder>OSA</copyright-holder><license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution-Noncommercial-No Derivative Works 3.0 Unported License, which permits download and redistribution, provided that the original work is properly cited. This license restricts the article from being modified or used commercially.</license-p></license></permissions><abstract><p>Monte Carlo (MC) simulation is widely recognized as a gold standard in biophotonics for its high accuracy. Here we analyze several issues associated with tetrahedron-based optical Monte Carlo simulation in the context of TIM-OS, MMCM, MCML, and CUDAMCML in terms of accuracy and efficiency. Our results show that TIM-OS has significant better performance in the complex geometry cases and has comparable performance with CUDAMCML in the multi-layered tissue model.</p></abstract><kwd-group kwd-group-type="OCIS"><title>OCIS codes: </title><kwd>(170.3660) Light propagation in tissues</kwd><kwd>(170.6920) Time-resolved imaging</kwd></kwd-group><funding-group><award-group><funding-source id="sp1">NIH</funding-source><award-id rid="sp1">R01HL098912</award-id></award-group></funding-group><custom-meta-group><custom-meta><meta-name>OpenAccess</meta-name><meta-value>True</meta-value></custom-meta><custom-meta><meta-name>OpenAccessEmbargo</meta-name><meta-value>12</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec sec-type="intro" id="sec1-1"><title>1. Introduction</title><p>Optical Monte Carlo (MC) simulation for complex heterogeneity has been a long-standing challenge since highly zigzag paths of photons in biological tissue make the determination of the ray-boundary intersection rather expensive. In simple geometry, such as the multi-layered tissue model used for MCML [<xref ref-type="bibr" rid="r1">1</xref>], a program can check the &#x0201c;Z&#x0201d; value of a photon to determine the ray-plane intersection. In complex geometry, there is no easy way to do the ray-boundary intersection test. With the advancement of computer graphics, the ray-tracing approach [<xref ref-type="bibr" rid="r2">2</xref>,<xref ref-type="bibr" rid="r3">3</xref>], which uses triangle mesh to represent a boundary, was introduced to the Monte Carlo simulation field [<xref ref-type="bibr" rid="r4">4</xref>]. However, there is a major difference between image rendering in computer graphics and photon propagation in biological tissue. A photon usually has a very long step size for image rendering, because it only changes its direction when it hits a surface [<xref ref-type="bibr" rid="r2">2</xref>,<xref ref-type="bibr" rid="r3">3</xref>]. On the other hand, biological tissue is highly scattering, and the step size of a photon is usually very small (~0.1 mm) [<xref ref-type="bibr" rid="r5">5</xref>,<xref ref-type="bibr" rid="r6">6</xref>]. Hence, a classic ray-tracing algorithm will take a huge amount of computational power in traveling around a complex data structure used.</p><p>In February 2010, we published a tetrahedron-based inhomogeneous optical Monte Carlo simulator (TIM-OS) [<xref ref-type="bibr" rid="r7">7</xref>] to handle complex heterogeneous geometry and reduce computational time. In the algorithm, the photon propagation is guided by a tetrahedral mesh. Since each tetrahedron has only four triangular surfaces, it becomes straightforward to compute the photon-surface interaction for a photon in a tetrahedron. Hence, it is not surprising that TIM-OS runs at least one order of magnitude faster than other ray-tracing-based implementations, such as MOSE [<xref ref-type="bibr" rid="r8">8</xref>] and Tri3DMC [<xref ref-type="bibr" rid="r4">4</xref>], as shown in [<xref ref-type="bibr" rid="r7">7</xref>]. With such an improvement, we applied TIM-OS in several applications such as optical clearing [<xref ref-type="bibr" rid="r9">9</xref>] and frequency-domain MC simulation [<xref ref-type="bibr" rid="r10">10</xref>]. We will see more applications for TIM-OS, such as, optical coherence tomography [<xref ref-type="bibr" rid="r11">11</xref>,<xref ref-type="bibr" rid="r12">12</xref>], laser therapy design [<xref ref-type="bibr" rid="r13">13</xref>,<xref ref-type="bibr" rid="r14">14</xref>], bioluminescence/fluorescence tomography [<xref ref-type="bibr" rid="r15">15</xref>,<xref ref-type="bibr" rid="r16">16</xref>], and photoacoustic tomography [<xref ref-type="bibr" rid="r17">17</xref>,<xref ref-type="bibr" rid="r18">18</xref>].</p><p>In July 2010, Fang proposed a &#x0201c;Mesh-based Monte Carlo Method&#x0201d; (MMCM) and developed a tetrahedron-based optical MC simulator [<xref ref-type="bibr" rid="r19">19</xref>]. MMCM uses Pl&#x000fc;cker coordinates for photon-tetrahedron intersection. Pl&#x000fc;cker coordinates has been widely used for ray-tracing to perform ray-triangle/tetrahedron intersection testing [<xref ref-type="bibr" rid="r20">20</xref>]. A major advantage with Pl&#x000fc;cker coordinates is the ability to handle a general mesh. As a result, MMCM can be extended to support various meshes such as a hexahedral mesh. Furthermore, MMCM uses linear Lagrange basis functions to represent fluence distributions, i.e., fluence is stored in the nodes of the mesh, and interpolation is used to compute the fluence at any position. In addition to use linear Lagrange basis functions for fluence quantification, it can be used to support continuous varying media, which is desirable in some applications. However, there is no detail information on how to support this feature in the MMCM paper, and the current MMCM simulation package (downloaded at 09/29/2010 from MMCM website at: <ext-link ext-link-type="uri" xlink:href="http://mcx.sourceforgo.net/mmc">http://mcx.sourceforgo.net/mmc</ext-link>) does not support this feature either.</p><p>In this article, we first compare the Pl&#x000fc;cker coordinate scheme in the MMCM paper with the TIM-OS implementation. Then, we analyze the problems in a direct linear Lagrange basis function scheme for continuous optical parameter. To overcome those problems, we propose a hybrid scheme to combine the linear Lagrange scheme and the piece-wise constant scheme, compare the piece-wise constant implementation (original TIM-OS) with the linear Lagrange scheme, and demonstrate the capability of TIM-OS for time-resolved MC simulation. Finally, we compare TIM-OS with three simulators in the two scenarios: MCML [<xref ref-type="bibr" rid="r1">1</xref>] and CUDAMCML [<xref ref-type="bibr" rid="r21">21</xref>,<xref ref-type="bibr" rid="r22">22</xref>] for the multi-layered tissue model and MMCM [<xref ref-type="bibr" rid="r19">19</xref>] for the general heterogeneous model.</p></sec><sec sec-type="methods" id="sec1-2"><title>2. Methods</title><sec id="sec2-1"><title>2.1. Photon-mesh intersection</title><sec id="sec3-1"><title>2.1.1. General mesh support</title><p>Biological tissue is turbid with strong scattering for visible/NIR light. In such media, a photon usually has a very small mean free path. Thus, a photon changes its direction frequently. In optical Monte Carlo simulation, whenever a photon changes its direction, the photon-mesh intersection test needs to be performed. Hence, the efficiency of the photon-mesh intersection test has a great impact on the overall performance. Because an element (no matter it is a tetrahedron, a hexahedron or any other shape) in a mesh is on average much larger than the mean free path of a photon, a mesh with a simpler shape shall be more efficient for the photon-mesh intersection test. Thus, the tetrahedron, which is simple in shape and powerful in representation, should have the speed advantage over all other types of mesh elements.</p><p>For the above reason, if an application needs to use a mesh different from a tetrahedron mesh, we can always use a preprocessor to decompose such a general mesh to a finer tetrahedral mesh, and then a postprocessor can convert the simulation result back to the original mesh with little additional computational cost. For example, a hexahedron can be partitioned into 5 or 6 tetrahedra, a pentahedron into 3 tetrahedra, and a quadratic tetrahedron into 8 tetrahedra.</p></sec><sec id="sec3-2"><title>2.1.2. Computational analysis</title><p>If a tetrahedral mesh is selected to represent an object, an efficient algorithm for photon-tetrahedron intersection is needed to achieve high performance. Pl&#x000fc;cker coordinates has been widely used to perform ray-triangle/ray-tetrahedron intersection in computer graphics [<xref ref-type="bibr" rid="r20">20</xref>]. MMCM used the Pl&#x000fc;cker coordinates for the same purpose in the optical Monte Carlo simulation [<xref ref-type="bibr" rid="r19">19</xref>]. The Pl&#x000fc;cker scheme provides a rigorous way to determine whether a photon will penetrate a triangle. When ray-tracing is being conducted in an image rendering scenario, the ability to determine whether the ray hits a triangle internally is needed. Since the ray may not hit a triangle, even if the triangle is the closest one to the ray path, as shown in <xref ref-type="fig" rid="g001">Fig. 1(a)</xref>
<fig id="g001" fig-type="figure" position="float"><label>Fig. 1</label><caption><p>Illustration of photon-mesh intersection under imaging rendering scenario and optical Monte Carlo simulation. (a) A photon may not hit the closest triangle in a general triangle mesh in imaging rendering, and (b) if a photon is inside a tetrahedron, then the photon will hit the closest triangle internally.</p></caption><graphic xlink:href="boe-2-1-44-g001"/></fig> in which the closeness of a triangle to a photon path is defined in terms of the distance from the photon position to the intersection of the photon path and the plane containing the triangle. Nevertheless, if we already know that a photon is inside a tetrahedron, the extra computation to determine whether or not the intersection point is inside the triangle becomes unnecessary. As shown in <xref ref-type="fig" rid="g001">Fig. 1(b)</xref>, if a photon is inside a tetrahedron, the photon will hit inside the closest triangle along its path first. Hence, instead of determining if a photon will hit a triangle internally, we only need to find the closest triangle along the photon path, as implemented in TIM-OS [<xref ref-type="bibr" rid="r7">7</xref>]. As shown in the simplified pseudo-code in Appendix A, the average operations needed using the Pl&#x000fc;cker scheme for one photon-tetrahedron test is about 78 basic operations, including &#x0201c;+&#x0201d;, &#x0201c;-&#x0201d;, &#x0201c;&#x000d7;&#x0201d;, &#x0201c;/&#x0201d;, branching, and Boolean operations. On the other hand, the TIM-OS scheme only needs 44 basis operations. Hence, the TIM-OS scheme is faster than the Pl&#x000fc;cker scheme for optical Monte Carlo simulation.</p></sec></sec><sec id="sec2-2"><title>2.2. Linear Lagrange scheme</title><p>To support continuous varying media using linear Lagrange basis functions, we need to assign optical parameters to the nodes of a mesh. Then, the optical parameters at an internal position in a tetrahedron can be interpolated from the optical parameters of the four nodes of the tetrahedron. Unfortunately, there are several major issues for this scheme. First, since linear Lagrange basis functions can only represent a linear continuous function, the fundamental limitation of this approach is that discontinuity in an optical parameter distribution cannot be represented. Second, a photon shall follow a curvilinear path if the nodes of the tetrahedron have different refractive indexes, and it is not trivial to follow a curved path. Third, it is more complicated to determine the step size of a photon if it is in a tetrahedron with different optical coefficients on its nodes.</p><p>Although there are several difficulties in representing a linear continuous optical parameter distribution, we agree that such a representation capability would be interesting for finite element analysis. For example, optical clearing [<xref ref-type="bibr" rid="r9">9</xref>], which creates a continuing optical parameter distribution in the tissue with mechanical compression, could be a potential application of this model.</p><p>To overcome the fundamental limitation of linear Lagrange basis functions, a possible solution is that we can use a non-uniform rational B-spline (NURBs) [<xref ref-type="bibr" rid="r23">23</xref>] technique to represent an optical distribution. Nevertheless, this will make the computation of the photon step size extremely complex. Another way is a hybrid method that combines the piece-wise constant scheme with the linear Lagrange scheme. In this hybrid scheme, optical parameters are stored in tetrahedral mesh: the four nodes share the same optical parameters for a tetrahedron labeled with a piece-wise constant scheme and the four nodes have different optical parameters for a tetrahedron labeled with a linear Lagrange scheme. Definitely, there are other possible methods to overcome this problem. In the following section, we report a hybrid scheme in our TIM-OS framework.</p><p>Since the scheme used in MCML [<xref ref-type="bibr" rid="r1">1</xref>] can be applied to piece-wise constant scheme directly [<xref ref-type="bibr" rid="r7">7</xref>], in the following sections, we will only describe the MC simulation in the linear Lagrange scheme. We assume that the refractive index is always piece-wise constant to avoid the curvilinear path of a photon in a tetrahedron. The general case can be handled using variational calculus.</p><p>At a position <inline-formula><mml:math id="m1"><mml:mrow><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula>in a tetrahedron with four nodes: <inline-formula><mml:math id="m2"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m3"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m4"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m5"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m6"><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover></mml:math></inline-formula> can be expressed as</p><disp-formula id="e1"><mml:math id="m7"><mml:mrow><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:munderover><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mtext>&#x02003;with&#x02003;</mml:mtext><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:munderover><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mtext>&#x02003;and&#x02003;</mml:mtext><mml:mn>0</mml:mn><mml:mo>&#x02264;</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&#x02264;</mml:mo><mml:mn>1.</mml:mn></mml:mrow></mml:math><label>(1)</label></disp-formula><p>If <inline-formula><mml:math id="m8"><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover></mml:math></inline-formula> is not within the tetrahedron, then some <inline-formula><mml:math id="m9"><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> will be negative or greater than 1. Let <inline-formula><mml:math id="m10"><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>&#x02212;</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, then <inline-formula><mml:math id="m11"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>3</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mo>=</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula>. Hence,</p><disp-formula id="e2"><mml:math id="m12"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>3</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">[</mml:mo><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math><label>(2)</label></disp-formula><p>If the optical parameters on the four nodes of the tetrahedron are <inline-formula><mml:math id="m13"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m14"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m15"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m16"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>, respectively, then the optical parameter on node <inline-formula><mml:math id="m17"><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover></mml:math></inline-formula> is <inline-formula><mml:math id="m18"><mml:mrow><mml:mi>&#x003bc;</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:msubsup><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula>. Now, assume that a photon will move along a direction <inline-formula><mml:math id="m19"><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover></mml:math></inline-formula> with a step size <italic>s</italic>, then the new position will be <inline-formula><mml:math id="m21"><mml:mrow><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>'</mml:mo><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:msubsup><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula>. Hence,</p><disp-formula><mml:math id="m22"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>3</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">[</mml:mo><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>&#x021bc;</mml:mo></mml:mover><mml:mi>s</mml:mi><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>3</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">[</mml:mo><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo stretchy="false">]</mml:mo><mml:mi>s</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula><p>Let</p><disp-formula><mml:math id="m23"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>3</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">[</mml:mo><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></disp-formula><p>and</p><disp-formula id="e3"><mml:math id="m24"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mi>&#x00394;</mml:mi><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mi>s</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math><label>(3)</label></disp-formula><p>Then, we have</p><disp-formula id="e4"><mml:math id="m25"><mml:mrow><mml:mi>&#x003bc;</mml:mi><mml:mo>'</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>l</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>&#x022c5;</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>&#x003bc;</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>&#x00394;</mml:mtext><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mtext>&#x00394;</mml:mtext><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mtext>&#x00394;</mml:mtext><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mi>s</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math><label>(4)</label></disp-formula><p>The above formula shows that the optical parameter changes linearly in a tetrahedron along any direction.</p><p>Let <inline-formula><mml:math id="m26"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>s</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> be the interaction coefficient at position <inline-formula><mml:math id="m27"><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover></mml:math></inline-formula>, and <inline-formula><mml:math id="m28"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the interaction coefficients for nodes <inline-formula><mml:math id="m29"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m30"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>&#x022ef;</mml:mo><mml:mo>,</mml:mo><mml:mn>4</mml:mn></mml:mrow></mml:math></inline-formula>. Then, along the direction <inline-formula><mml:math id="m31"><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover></mml:math></inline-formula>, the interaction coefficients will be <inline-formula><mml:math id="m32"><mml:mrow><mml:mi>&#x003bc;</mml:mi><mml:msub><mml:mo>'</mml:mo><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="m33"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>&#x00394;</mml:mtext><mml:msub><mml:mi>l</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mtext>&#x00394;</mml:mtext><mml:msub><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mtext>&#x00394;</mml:mtext><mml:msub><mml:mi>l</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>t</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, then the step size <italic>s</italic> of a photon should satisfy the following equation:</p><disp-formula id="e5"><mml:math id="m35"><mml:mrow><mml:munderover><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>&#x0222b;</mml:mo></mml:mstyle><mml:mn>0</mml:mn><mml:mi>s</mml:mi></mml:munderover><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mi>x</mml:mi><mml:mi>d</mml:mi><mml:mi>x</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mi>a</mml:mi><mml:msup><mml:mi>s</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mtext>ln</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mi>&#x003be;</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math><label>(5)</label></disp-formula><p>where &#x003be; is a uniform random number between 0 to 1. If <inline-formula><mml:math id="m37"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, then <inline-formula><mml:math id="m38"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mi>ln</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>&#x003be;</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. If <inline-formula><mml:math id="m39"><mml:mrow><mml:mi>a</mml:mi><mml:mo>&#x0003e;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="m40"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msqrt><mml:mrow><mml:msubsup><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02212;</mml:mo><mml:mn>2</mml:mn><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>&#x003be;</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula>. If <inline-formula><mml:math id="m41"><mml:mrow><mml:mi>a</mml:mi><mml:mo>&#x0003c;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, then it is possible that there is no real solution for the equation. In this case, if <inline-formula><mml:math id="m42"><mml:mrow><mml:msubsup><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02212;</mml:mo><mml:mn>2</mml:mn><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>&#x003be;</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>&#x02265;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, then <inline-formula><mml:math id="m43"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msqrt><mml:mrow><mml:msubsup><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02212;</mml:mo><mml:mn>2</mml:mn><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>&#x003be;</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula>. If <inline-formula><mml:math id="m44"><mml:mrow><mml:msubsup><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02212;</mml:mo><mml:mn>2</mml:mn><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>&#x003be;</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>&#x0003c;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, it means that the step size of the photon is too large. To solve this problem, we can first have a step size of <inline-formula><mml:math id="m45"><mml:mrow><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>/</mml:mo><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> and save the rest part: <inline-formula><mml:math id="m46"><mml:mrow><mml:mi>ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>&#x003be;</mml:mi><mml:mo>'</mml:mo></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>ln</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>&#x003be;</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mi>&#x003bc;</mml:mi><mml:mi>t</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>/</mml:mo><mml:mn>2</mml:mn><mml:mi>a</mml:mi></mml:mrow></mml:math></inline-formula> for the next step. If a photon needs to go through several regions, we can use the same scheme in MCML [<xref ref-type="bibr" rid="r1">1</xref>].</p><p>The anisotropy scattering factor can be treated simply. Each time when we move a photon to a scattering location, we can compute the local anisotropy scattering factor using the following equation:</p><disp-formula id="e6"><mml:math id="m47"><mml:mrow><mml:mi>g</mml:mi><mml:mo>'</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:munderover><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:math><label>(6)</label></disp-formula><p>where <inline-formula><mml:math id="m48"><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the anisotropy scattering factor for node <inline-formula><mml:math id="m49"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="m50"><mml:mrow><mml:msub><mml:mi>l</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> defined by <xref ref-type="disp-formula" rid="e2">Eq. (2)</xref>.</p><p>In addition to the aforementioned issues on how to use linear Lagrange basis functions for the optical parameter presentation, there is also a problem in the volumetric absorption/fluence quantification. In MC, the volumetric fluence for a tetrahedron is computed as: <inline-formula><mml:math id="m51"><mml:mrow><mml:mi>&#x003a6;</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>V</mml:mi><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where &#x003a6; is the fluence, <inline-formula><mml:math id="m53"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> the absorbed energy, <italic>V</italic> the volume, and <inline-formula><mml:math id="m55"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> the absorption coefficient. In the piece-wise constant scheme, this formula works well. We can easily convert from absorbed energy to fluence or from fluence to absorbed energy. In the linear Lagrange scheme, since in a tetrahedron the local absorption coefficient may change over absorption locations, the fluence computation needs a different formula:</p><disp-formula id="e7"><mml:math id="m56"><mml:mrow><mml:mtext>&#x003a6;</mml:mtext><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>&#x02211;</mml:mo></mml:mstyle><mml:mtext>&#x0200b;</mml:mtext></mml:msup><mml:mfrac><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mi>V</mml:mi></mml:mrow></mml:math>, 	<label>(7)</label></disp-formula><p>where <inline-formula><mml:math id="m57"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>is the local absorption coefficient at the absorption location for energy <inline-formula><mml:math id="m58"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. However, after the simulation we cannot precisely convert the fluence back to the absorbed energy. The only way to have the information is to store both the absorbed energy and the fluence separately. This will increase the memory usage and decrease the simulation speed, especially in the time-domain simulation.</p></sec></sec><sec sec-type="results" id="sec1-3"><title>3. Results</title><p>TIM-OS was implemented in C/C +  + and compiled with an Intel C compiler on Ubuntu 9.10 64bit Linux. We implemented the linear Lagrange basis function to represent optical properties in the same framework of TIM-OS. A workstation with a non-uniform memory architecture (NUMA), two Xeon L5520 CPUs (8 CPU cores with hyper-threading enabled), 32GB memory and 4 Nvidia Tesla C1060 graphics card was used in all the simulation tests. We used 32 threads for TIM-OS. In all the following tests, the unit is in millimeter for length and <inline-formula><mml:math id="m59"><mml:mrow><mml:msup><mml:mrow><mml:mtext>mm</mml:mtext></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> for absorption and scattering coefficients. Optical parameters vary significantly with wavelength and tissue type. At 700nm, scattering coefficients for mouse organs are between 6.48mm<sup>&#x02212;1</sup> and 23.4mm<sup>&#x02212;1</sup> and the absorption coefficients between 0.0027mm<sup>&#x02212;1</sup> to 0.23mm<sup>&#x02212;1</sup> [<xref ref-type="bibr" rid="r10">10</xref>]. While all of our examples are artificial examples, we selected the optical parameters within or close to the aforementioned ranges.</p><sec id="sec2-3"><title>3.1 Comparison of linear Lagrange and piece-wise constant schemes</title><p>In this experiment, a cubic phantom was used. It is of size <inline-formula><mml:math id="m60"><mml:mrow><mml:mn>6</mml:mn><mml:mo>&#x000d7;</mml:mo><mml:mn>6</mml:mn><mml:mo>&#x000d7;</mml:mo><mml:mn>6</mml:mn></mml:mrow></mml:math></inline-formula> mm centered at the origin <inline-formula><mml:math id="m61"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> mm (<xref ref-type="fig" rid="g002">Fig. 2</xref>
<fig id="g002" fig-type="figure" position="float"><label>Fig. 2</label><caption><p>A cubic phantom with linearly varying optical parameter distributions and three sources.</p></caption><graphic xlink:href="boe-2-1-44-g002"/></fig>). Three different sources were used in the experiment: a point source located at <inline-formula><mml:math id="m62"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>0.2</mml:mn><mml:mo>,</mml:mo><mml:mn>1.5</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> mm, a pencil beam source located at <inline-formula><mml:math id="m63"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mn>0.1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> mm in a direction <inline-formula><mml:math id="m64"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> mm, or a pencil beam source located at <inline-formula><mml:math id="m65"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>0.1</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> mm in a direction <inline-formula><mml:math id="m66"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> mm. Four tetrahedral meshes were generated with 6, 750, 6,000, and 48,000 tetrahedra. We first compared the linear Lagrange and piece-wise constant schemes under a uniform optical condition (<inline-formula><mml:math id="m67"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m68"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m69"><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula>, and<inline-formula><mml:math id="m70"><mml:mrow><mml:mo>&#x000a0;</mml:mo><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1.3</mml:mn></mml:mrow></mml:math></inline-formula>). The results showed that the two schemes matched almost exactly. Then, we considered an optical distribution where the top surface of the cube had lower absorption and higher scattering (<inline-formula><mml:math id="m71"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m72"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m73"><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula>, and<inline-formula><mml:math id="m74"><mml:mrow><mml:mo>&#x000a0;</mml:mo><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1.3</mml:mn></mml:mrow></mml:math></inline-formula>) and the lower surface of the cube had higher absorption and lower scattering (<inline-formula><mml:math id="m75"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula> mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m76"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m77"><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula>, and<inline-formula><mml:math id="m78"><mml:mrow><mml:mo>&#x000a0;</mml:mo><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1.3</mml:mn></mml:mrow></mml:math></inline-formula>). In the piece-wise constant scheme, the optical parameters for a tetrahedron were determined by the center position of the tetrahedron. In linear Lagrange scheme, the optical parameters were assigned to the nodes of the mesh. We then simulated light propagation using the two schemes respectively for 12 combinations of four meshes and three source positions. In each case, 10<sup>9</sup> photons were simulated.</p><p>Let <inline-formula><mml:math id="m79"><mml:mrow><mml:mi>&#x003a6;</mml:mi><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mi>&#x003d5;</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mn>...</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>&#x003d5;</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> represent the fluence values, and <inline-formula><mml:math id="m80"><mml:mrow><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> the surface fluence values from the linear Lagrange scheme, <inline-formula><mml:math id="m81"><mml:mrow><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> the volumetric fluence from the linear Lagrange scheme, <inline-formula><mml:math id="m82"><mml:mrow><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> the surface fluence values from the piece-wise constant scheme, <inline-formula><mml:math id="m83"><mml:mrow><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> the volumetric fluence values from the piece-wise constant scheme. In this example, we compared five quantities for the two schemes: (1) the average relative difference in the surface fluence (<inline-formula><mml:math id="m84"><mml:mrow><mml:mi>E</mml:mi><mml:mn>1</mml:mn><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mfrac><mml:mrow><mml:mo>|</mml:mo><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula>), (2) the relative difference in the maximal surface fluence (<inline-formula><mml:math id="m85"><mml:mrow><mml:mi>E</mml:mi><mml:mn>2</mml:mn><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mi>max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>), (3) the average relative difference in the volumetric fluence (<inline-formula><mml:math id="m86"><mml:mrow><mml:mi>E</mml:mi><mml:mn>3</mml:mn><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mfrac><mml:mrow><mml:mo>|</mml:mo><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:math></inline-formula>), (4) the relative difference in the maximal volumetric fluence (<inline-formula><mml:math id="m87"><mml:mrow><mml:mi>E</mml:mi><mml:mn>4</mml:mn><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mi>max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>&#x003a6;</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>), and (5) the relative difference in the total escaped energy (<inline-formula><mml:math id="m88"><mml:mrow><mml:mi>E</mml:mi><mml:mn>5</mml:mn><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo>&#x02212;</mml:mo><mml:mstyle displaystyle="true"><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>), where <inline-formula><mml:math id="m89"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the size of the triangle for surface fluence <inline-formula><mml:math id="m90"><mml:mrow><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> or <inline-formula><mml:math id="m91"><mml:mrow><mml:msubsup><mml:mi>&#x003d5;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> . <xref ref-type="table" rid="t001">Table 1</xref>
<table-wrap id="t001" position="float"><label>Table 1</label><caption><title>Differences between the original and hybrid TIM-OS schemes. TIM-OS represents piece-wise constant scheme and TIM-OS-L stands for linear Lagrange scheme.</title></caption><table frame="hsides" rules="groups"><col width="11.17%" span="1"/><col width="6.12%" span="1"/><col width="6.32%" span="1"/><col width="2.28%" span="1"/><col width="7.62%" span="1"/><col width="4.3%" span="1"/><col width="3.33%" span="1"/><col width="11.38%" span="1"/><col width="3.33%" span="1"/><col width="11.39%" span="1"/><col width="3.33%" span="1"/><col width="11.38%" span="1"/><col width="3.33%" span="1"/><col width="11.39%" span="1"/><col width="3.33%" span="1"/><thead><tr><th valign="middle" colspan="2" align="left" scope="colgroup" rowspan="1"/><th valign="middle" colspan="2" align="left" scope="colgroup" rowspan="1"/><th valign="middle" align="left" scope="col" rowspan="1" colspan="1"/><th valign="middle" colspan="2" align="left" scope="colgroup" rowspan="1"/><th colspan="8" valign="top" align="center" scope="colgroup" rowspan="1">#&#x000a0;Tetrahedra<hr/></th></tr><tr><th colspan="2" valign="top" align="left" scope="colgroup" rowspan="1">Meshes</th><th colspan="5" valign="top" align="left" scope="colgroup" rowspan="1"/><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">6</th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">750</th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">6000</th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">48000</th></tr></thead><tbody><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1">Relative</td><td colspan="3" valign="top" align="right" rowspan="1">E1</td><td colspan="2" valign="top" align="char" char="." rowspan="1">3.39%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.31%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.16%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.18%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1">Difference</td><td colspan="3" valign="top" align="right" rowspan="1">E2</td><td colspan="2" valign="top" align="char" char="." rowspan="1">10.1%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.23%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.81%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.95%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">Point</td><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E3</td><td colspan="2" valign="top" align="char" char="." rowspan="1">4.07%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.3%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.12%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.094%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">source</td><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E4</td><td colspan="2" valign="top" align="char" char="." rowspan="1">7.16%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.85%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.53%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.51%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E5</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.97%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.043%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.0076%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.0015%</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="center" rowspan="1">Run&#x000a0;Time&#x000a0;(S)</td><td colspan="3" valign="top" align="right" rowspan="1">TIM&#x02011;OS</td><td colspan="2" valign="top" align="char" char="." rowspan="1">732</td><td colspan="2" valign="top" align="char" char="." rowspan="1">791</td><td colspan="2" valign="top" align="char" char="." rowspan="1">952</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1437</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">TIM&#x02011;OS&#x02011;L</td><td colspan="2" valign="top" align="char" char="." rowspan="1">898</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1092</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1364</td><td colspan="2" valign="top" align="char" char="." rowspan="1">2166</td></tr><tr><td valign="middle" colspan="14" align="char" char="." scope="col" rowspan="1">&#x000a0;</td></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1">Relative</td><td colspan="3" valign="top" align="right" rowspan="1">E1</td><td colspan="2" valign="top" align="char" char="." rowspan="1">3.39%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.27%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.27%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.18%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1">Difference</td><td colspan="3" valign="top" align="right" rowspan="1">E2</td><td colspan="2" valign="top" align="char" char="." rowspan="1">5.13%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.76%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.54%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.81%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">Pencil</td><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E3</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.83%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.21%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.35%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.14%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">beam</td><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E4</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.50%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.82%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.44%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.44%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">source&#x000a0;-&#x000a0;1</td><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E5</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.74%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.0003%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.09%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.019%</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="center" rowspan="1">Run&#x000a0;Time&#x000a0;(S)</td><td colspan="3" valign="top" align="right" rowspan="1">TIM&#x02011;OS</td><td colspan="2" valign="top" align="char" char="." rowspan="1">835</td><td colspan="2" valign="top" align="char" char="." rowspan="1">983</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1150</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1649</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">TIM&#x02011;OS&#x02011;L</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1314</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1334</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1649</td><td colspan="2" valign="top" align="char" char="." rowspan="1">2490</td></tr><tr><td valign="middle" colspan="14" align="char" char="." scope="col" rowspan="1">&#x000a0;</td></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1">Relative</td><td colspan="3" valign="top" align="right" rowspan="1">E1</td><td colspan="2" valign="top" align="char" char="." rowspan="1">5.31%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.28%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.21%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.18%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1">Difference</td><td colspan="3" valign="top" align="right" rowspan="1">E2</td><td colspan="2" valign="top" align="char" char="." rowspan="1">12.85%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.45%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.97%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.73%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">Pencil</td><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E3</td><td colspan="2" valign="top" align="char" char="." rowspan="1">3.28%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.21%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.23%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.083%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">beam</td><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E4</td><td colspan="2" valign="top" align="char" char="." rowspan="1">4.03%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.05%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.52%*</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.32%*</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">source&#x000a0;-&#x000a0;2</td><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">E5</td><td colspan="2" valign="top" align="char" char="." rowspan="1">2.65%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.032%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.041%</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.0036%</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="center" rowspan="1">Run&#x000a0;Time&#x000a0;(S)</td><td colspan="3" valign="top" align="right" rowspan="1">TIM&#x02011;OS</td><td colspan="2" valign="top" align="char" char="." rowspan="1">793</td><td colspan="2" valign="top" align="char" char="." rowspan="1">905</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1091</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1625</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="left" rowspan="1"/><td colspan="3" valign="top" align="right" rowspan="1">TIM&#x02011;OS&#x02011;L</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1031</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1255</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1549</td><td colspan="2" valign="top" align="char" char="." rowspan="1">2458</td></tr></tbody></table><table-wrap-foot><p>*Indicates that the result comes from the first 1,000 largest fluence values from surface triangles or tetrahedra.</p></table-wrap-foot></table-wrap> shows the results obtained with the two schemes. While the number of tetrahedra becomes larger, the size of each tetrahedron becomes smaller; the elements far away from the source will have low absorbed energy and high noise. To reduce the noise, we only considered the 1,000 largest fluence values for comparison. As shown in <xref ref-type="table" rid="t001">Table 1</xref>, when the mesh contains only 6 tetrahedra, the two schemes have major difference. When the number of tetrahedra reaches 750 (the average volume of a tetrahedron was 0.288 mm<sup>3</sup>), the two schemes performed almost exactly the same. In addition to that, the positions of the maximal fluence values from the two schemes matched exactly on all the four meshes. Also, as shown in <xref ref-type="table" rid="t001">Table 1</xref>, the piece-wise constant scheme was about 30% faster than the linear Lagrange scheme.</p><p>One needs to pay an attention to the scalability of TIM-OS. As show in <xref ref-type="table" rid="t001">Table 1</xref>, when the number of tetrahedra was increased by 8,000 times, the running time of the original TIM-OS was only increased by about one fold. Although there is some advantage in representing an optical parameter distribution more accurately with linear Lagrange basis functions, the original TIM-OS scheme can always be applied to a finer mesh for an almost identical result at a less computational cost than that with linear Lagrange basis functions.</p></sec><sec id="sec2-4"><title>3.2. Time-resolved simulation</title><p>While we already demonstrated and validated the time-resolved TIM-OS for frequency-domain fluorescence imaging [<xref ref-type="bibr" rid="r10">10</xref>], here we show another interesting example, which illustrates the use of glass material in the simulation to support some realistic light source types. As shown in <xref ref-type="fig" rid="g003">Fig. 3</xref>
<fig id="g003" fig-type="figure" position="float"><label>Fig. 3</label><caption><p>Time resolved simulation for a laser pulse. (a) A spherical lens in air, (b), (c), (d) and (e) the simulation results for the phantom (a) at time instants 0.1 ps, 4.9 ps, 10 ps and 15 ps, respectively; (f) A spherical lens under tissue, (g), (h), (i) and (j) the simulation results for the phantom (f) at time instants 0.1 ps, 4.9 ps, 10 ps and 15 ps, respectively.</p></caption><graphic xlink:href="boe-2-1-44-g003"/></fig>, we set up two numerical phantoms. The first phantom contained a spherical lens in the air to demonstrate that a laser pulse can be focused by the lens. A tissue layer was added above the spherical lens in the second phantom to demonstrate that the light propagation in tissue. The mesh used in the simulation was generated using NetGen [<xref ref-type="bibr" rid="r24">24</xref>] with 1,202,941 tetrahedra. <xref ref-type="table" rid="t002">Table 2</xref>
<table-wrap id="t002" position="float"><label>Table 2</label><caption><title>Optical parameters for air, glass, and tissue used in TIM-OS</title></caption><table frame="hsides" rules="groups"><col width="13.3%" span="1"/><col width="1.38%" span="1"/><col width="23.14%" span="1"/><col width="1.38%" span="1"/><col width="22.13%" span="1"/><col width="1.38%" span="1"/><col width="15.27%" span="1"/><col width="1.38%" span="1"/><col width="19.26%" span="1"/><col width="1.38%" span="1"/><thead><tr><th colspan="2" valign="top" align="left" scope="colgroup" rowspan="1">Material</th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">Absorption&#x000a0;(mm<sup>&#x02212;1</sup>)</th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">Scattering&#x000a0;(mm<sup>&#x02212;1</sup>)</th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">Anisotropy</th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">Refractive&#x000a0;index</th></tr></thead><tbody><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">Air</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.001</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.0003</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">Glass</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.001</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.4580</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">Tissue</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.050</td><td colspan="2" valign="top" align="char" char="." rowspan="1">10</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.9</td><td colspan="2" valign="top" align="char" char="." rowspan="1">1.3600</td></tr></tbody></table></table-wrap> shows the optical parameters used in this simulation.</p><p>It has always been tricky for an MC simulator to deal with regions with no absorption and scattering, such as ideal glass and air. Since in MC the quantification of volumetric fluence relies on an equation similar to <xref ref-type="disp-formula" rid="e6">Eq. (6)</xref> [<xref ref-type="bibr" rid="r1">1</xref>], which needs to normalize the absorbed energy by the absorption coefficient. However, in the ideal air/glass material the absorption is zero.</p><p>In TIM-OS, we can setup a material to be pure glass/air by setting the value of <italic>g</italic> to 1. A user can then set the absorption coefficient to some small value, and set the scattering coefficient to a value whose inverse is about 10 times of the average edge length of the mesh. In the simulation, when TIM-OS detects that a photon is in a glass/air region, it will still compute the absorbed weight (weight lost by absorption) in the glass/air region, but it will not reduce the absorbed weight from the photon&#x02019;s weight. Hence, the absorption/scattering coefficient in the glass/air region will neither affect the photon weight nor the photon path, because TIM-OS does not scatter the photon. A lower scattering coefficient in the glass/air region will allow TIM-OS to give a smooth volumetric fluence, while a larger scattering coefficient allows a faster simulation speed. By doing so, we need to remember that the true absorption and scattering coefficients in the pure glass/air region are zero, and the absorbed energy in the glass/air region is only for the sake of volumetric fluence computation.</p><p>In both the simulation cases, the time step was set to <inline-formula><mml:math id="m92"><mml:mrow><mml:mn>0.1</mml:mn><mml:mo>&#x000d7;</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>12</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> second (0.1 picosecond), and 500 steps were simulated. <xref ref-type="fig" rid="g003">Figure 3</xref> shows the simulation results at 0.1ps, 4.9ps, 10ps, and 15ps respectively. It can be seen that TIM-OS correctly simulated the focusing effect of the spherical lens and the wave front of the light pulse on the &#x0201c;Z&#x0201d; axis matched the analytical expected frontier well, which can be computed by the light speed in glass, air, and tissue. Please note that the tetrahedron size is much larger than the distance a photon travels in 0.1 ps. The large tetrahedron size certainly blurs the simulated wave front. In this simulation, it was also found that a large portion of the light from the source was directly reflected by the spherical surface of the lens. A different lens shape may have better light delivery efficiency. Two time-resolved movies were generated and uploaded to youtube.com and can be accessed at TIM-OS website at <ext-link ext-link-type="uri" xlink:href="http://www.imaging.sbes.vt.edu/software/">http://www.imaging.sbes.vt.edu/software/</ext-link>.</p></sec><sec id="sec2-5"><title>3.3. Comparison of MMCM, TIM-OS, MCML, and CUDAMCML</title><p>Based on the MMCM paper, Fang implemented a tetrahedron-based Monte Carlo simulator which is referred to as MMC [<xref ref-type="bibr" rid="r19">19</xref>]. While both MMC and TIM-OS use a tetrahedral mesh to guide photon propagation, the two schemes are quite different. It is necessary to validate the two simulators such as with MCML, which is a widely-used and well-accepted standard in the optical Monte Carlo simulation. The MMC software package was downloaded on September 29, 2010 from its website (<ext-link ext-link-type="uri" xlink:href="http://mcx.sourceforgo.net/mmc">http://mcx.sourceforgo.net/mmc</ext-link>) and compiled with OpenMP enabled (OMP_NUM_THREADS = 32 was set in the Linux system). MCML was enhanced by replacing the random number generator with the Mersenne Twister pseudorandom number generator in the Intel Math Kernel Library (MKL). The random number generator can create an array of random numbers to be used one by one as needed. In the following, we used the new MCML. Since MMC uses single precision floating point operations, we also included CUDAMCML, which is also in the single precision floating point format.</p><p>Initially, we did a comparison on some single-layer tissues with a refractive index mismatch on the boundary, because the refractive index mismatch is common in biophotonics. We observed that MMC had errors larger than the other three simulators. After some discussion with the author of MMC, we realized that the current MMC only solves problems with a constant refractive index (including the environment). Thus, in the following we will study problems with no refractive index mismatch.</p><p>The four simulators were tested on a simple single-layer tissue problem and a two-layer tissue problem. The thickness of the single-layer tissue is 1 mm. In MCML and CUDAMCML, a pencil light beam aimed at (0, 0, 0) mm with a direction (0, 0, 1). A tetrahedral mesh was generated using the MATLAB code in the MMC package. The mesh was of size 20 &#x000d7; 20 &#x000d7; 1 mm centered at the point (0, 0, 0.5) mm and contained 2,400 tetrahedra. In MMC and TIM-OS, we shifted the light source to (&#x02212;3.333E-4, &#x02212;6.667E-4, 0) mm to prevent the light from hitting a node directly. In the single-layer case, we simulated a low absorption case (<inline-formula><mml:math id="m93"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m94"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m95"><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula>) and a high absorption case (<inline-formula><mml:math id="m96"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.5</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m97"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m98"><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula>). Next, we compared the four simulators in the case of a two-layer tissue with two different materials: (<inline-formula><mml:math id="m99"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.05</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m100"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:math></inline-formula> mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m101"><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula>) and (<inline-formula><mml:math id="m102"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0.10</mml:mn></mml:mrow></mml:math></inline-formula>mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m103"><mml:mrow><mml:msub><mml:mi>&#x003bc;</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>5</mml:mn></mml:mrow></mml:math></inline-formula> mm<sup>&#x02212;1</sup>, <inline-formula><mml:math id="m104"><mml:mrow><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>0.9</mml:mn></mml:mrow></mml:math></inline-formula>). Each layer was 1 mm in thickness. A tetrahedral mesh was generated using the MATLAB code in the MMC package. The mesh was of size 40 &#x000d7; 40 &#x000d7; 2 mm centered at the point (0, 0, 1) mm and consisted of 12 tetrahedra. In MMC and TIM-OS, we shifted the light source to (3.333E-2, &#x02212;3.333E-2, 0) mm to prevent the light from hitting a node directly.</p><p>In all the following simulation tests, we only focused on one index - the absorbed fraction, i.e., the total absorbed energy divided by the total source energy. In each case, 10 simulation runs were performed with different random seeds. In each case, 30 million of photons were simulated. The averages and standard deviations of the absorbed fraction were listed in <xref ref-type="table" rid="t003">Table 3</xref>
<table-wrap id="t003" position="float"><label>Table 3</label><caption><title>Comparison among MCML, CUDAMCML, MMC, and TIM-OS in a numerical study with a single-layer and two-layer tissue phantoms</title></caption><table frame="hsides" rules="groups"><col width="11.03%" span="1"/><col width="2.43%" span="1"/><col width="13.41%" span="1"/><col width="15.85%" span="1"/><col width="8.53%" span="1"/><col width="17.07%" span="1"/><col width="8.53%" span="1"/><col width="11.58%" span="1"/><col width="3.04%" span="1"/><col width="8.53%" span="1"/><thead><tr><th colspan="2" valign="top" align="left" scope="colgroup" rowspan="1"/><th valign="top" align="left" scope="col" rowspan="1" colspan="1"/><th colspan="4" valign="top" align="center" scope="colgroup" rowspan="1">Single&#x000a0;layer<hr/></th><th valign="top" align="left" scope="col" rowspan="1" colspan="1"/><th colspan="2" valign="top" align="left" scope="colgroup" rowspan="1"/></tr><tr><th colspan="2" valign="top" align="left" scope="colgroup" rowspan="1"/><th valign="top" align="left" scope="col" rowspan="1" colspan="1"/><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">Low&#x000a0;Absorption&#x000a0;Case<hr/></th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">High&#x000a0;Absorption&#x000a0;Case<hr/></th><th colspan="3" valign="top" align="center" scope="colgroup" rowspan="1">Two&#x000a0;layer<hr/></th></tr><tr><th colspan="2" valign="top" align="left" scope="colgroup" rowspan="1"/><th valign="top" align="left" scope="col" rowspan="1" colspan="1"/><th valign="top" align="center" scope="col" rowspan="1" colspan="1">Absorbed Fraction</th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">Time (sec)</th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">Absorbed Fraction</th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">Time (sec)</th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">Absorbed Fraction</th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">Time (sec)</th></tr></thead><tbody><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1">MCML</td><td colspan="2" valign="top" align="right" rowspan="1">Average</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0872044</td><td valign="middle" align="right" rowspan="1" colspan="1">91.9</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.5452665</td><td valign="middle" align="right" rowspan="1" colspan="1">96.5</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.2215219</td><td valign="middle" align="right" rowspan="1" colspan="1">155.8</td></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="right" rowspan="1">Std&#x000a0;Deviation</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0000105</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0000410</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="char" char="." rowspan="1">0.0000218</td><td valign="middle" align="left" rowspan="1" colspan="1"/></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="right" rowspan="1">Average</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0870503</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td valign="top" align="char" char="." rowspan="1" colspan="1">0.5443552</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="char" char="." rowspan="1">0.2211585</td><td valign="middle" align="left" rowspan="1" colspan="1"/></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1">CUDA</td><td colspan="2" valign="top" align="right" rowspan="1">Relative&#x000a0;Error</td><td valign="top" align="char" char="." rowspan="1" colspan="1">&#x02212;0.17674%</td><td valign="middle" align="right" rowspan="1" colspan="1">15.0</td><td valign="top" align="char" char="." rowspan="1" colspan="1">&#x02212;0.16712%</td><td valign="middle" align="right" rowspan="1" colspan="1">15.3</td><td colspan="2" valign="top" align="char" char="." rowspan="1">&#x02212;0.16405%</td><td valign="middle" align="right" rowspan="1" colspan="1">15.5</td></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1">MCML</td><td colspan="2" valign="top" align="right" rowspan="1">Std&#x000a0;Deviation</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0000080</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0000246</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="char" char="." rowspan="1">0.0000127</td><td valign="middle" align="left" rowspan="1" colspan="1"/></tr><tr><td valign="middle" colspan="10" align="left" scope="col" rowspan="1">&#x000a0;</td></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="right" rowspan="1">Average</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0872160</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td valign="top" align="char" char="." rowspan="1" colspan="1">0.5453470</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="char" char="." rowspan="1">0.2214840</td><td valign="middle" align="left" rowspan="1" colspan="1"/></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1">MMC</td><td colspan="2" valign="top" align="right" rowspan="1">Relative&#x000a0;Error</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.01330%</td><td valign="middle" align="right" rowspan="1" colspan="1">85.2</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.01476%</td><td valign="middle" align="right" rowspan="1" colspan="1">86.0</td><td colspan="2" valign="top" align="char" char="." rowspan="1">&#x02212;0.01710%</td><td valign="middle" align="right" rowspan="1" colspan="1">201.9</td></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="right" rowspan="1">Std&#x000a0;Deviation</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0000117</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0000343</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="char" char="." rowspan="1">0.0000267</td><td valign="middle" align="left" rowspan="1" colspan="1"/></tr><tr><td valign="middle" colspan="10" align="left" scope="col" rowspan="1">&#x000a0;</td></tr><tr><td valign="middle" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="right" rowspan="1">Average</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0872111</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td valign="top" align="char" char="." rowspan="1" colspan="1">0.5452786</td><td valign="middle" align="left" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="char" char="." rowspan="1">0.2215785</td><td valign="middle" align="left" rowspan="1" colspan="1"/></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">TIM-OS</td><td colspan="2" valign="top" align="right" rowspan="1">Relative&#x000a0;Error</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.00771%</td><td valign="top" align="right" rowspan="1" colspan="1">11.0</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.00222%</td><td valign="top" align="right" rowspan="1" colspan="1">11.6</td><td colspan="2" valign="top" align="char" char="." rowspan="1">0.02555%</td><td valign="top" align="right" rowspan="1" colspan="1">17.2</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="right" rowspan="1">Std&#x000a0;Deviation</td><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0000037</td><td valign="top" align="left" rowspan="1" colspan="1"/><td valign="top" align="char" char="." rowspan="1" colspan="1">0.0000280</td><td valign="top" align="left" rowspan="1" colspan="1"/><td colspan="2" valign="top" align="char" char="." rowspan="1">0.0000187</td><td valign="top" align="left" rowspan="1" colspan="1"/></tr></tbody></table></table-wrap>. Then, we used the average absorbed fraction of MCML as the reference to compute the relative errors. As shown in <xref ref-type="table" rid="t003">Table 3</xref>, the results of the four simulators all matched well.</p><p>As far as the computational efficiency is concerned, MCML used one CPU core, CUDAMCML used one Nvidia Tesla C1060 graphics card, MMC and TIM-OS used 32 threads to fully utilize 8 CPU cores. For the multi-layered tissue models, among the four simulators, CUDAMCML and TIM-OS were the fastest with comparable speeds. Note that MCML used only one CPU core in this comparative study. If MCML is parallelized on all eight cores of the computer, it should have a comparable speed as CUDAMCML and TIM-OS.</p><p>We also observed one interesting phenomenon with MMC. We used MMC to simulate cases with different numbers of photons: 10<sup>5</sup>, 10<sup>6</sup>, 10<sup>7</sup>, 10<sup>8</sup>, 2 &#x000d7; 10<sup>8</sup>, and 4 &#x000d7; 10<sup>8</sup>. The absorbed fractions for these six cases were shown in <xref ref-type="table" rid="t004">Table 4</xref>
<table-wrap id="t004" position="float"><label>Table 4</label><caption><title>Absorbed fractions with the single layer tissue phantom and different numbers of photons</title></caption><table frame="hsides" rules="groups"><col width="19.06%" span="1"/><col width="13.49%" span="1"/><col width="13.49%" span="1"/><col width="13.49%" span="1"/><col width="13.49%" span="1"/><col width="13.49%" span="1"/><col width="13.49%" span="1"/><thead><tr><th valign="top" align="left" scope="col" rowspan="1" colspan="1">#&#x000a0;Photon</th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">10<sup>5</sup></th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">10<sup>6</sup></th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">10<sup>7</sup></th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">10<sup>8</sup></th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">2&#x000a0;&#x000d7;&#x000a0;10<sup>8</sup></th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">4&#x000a0;&#x000d7;&#x000a0;10<sup>8</sup></th></tr></thead><tbody><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">MMC</td><td valign="top" align="left" rowspan="1" colspan="1">0.087240</td><td valign="top" align="left" rowspan="1" colspan="1">0.087230</td><td valign="top" align="left" rowspan="1" colspan="1">0.087230</td><td valign="top" align="left" rowspan="1" colspan="1">0.087910</td><td valign="top" align="left" rowspan="1" colspan="1"><bold>0.081950</bold></td><td valign="top" align="left" rowspan="1" colspan="1"><bold>0.064700</bold></td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">MCML</td><td valign="top" align="left" rowspan="1" colspan="1">0.087611</td><td valign="top" align="left" rowspan="1" colspan="1">0.087204</td><td valign="top" align="left" rowspan="1" colspan="1">0.087205</td><td valign="top" align="left" rowspan="1" colspan="1">0.087203</td><td valign="top" align="left" rowspan="1" colspan="1">0.087206</td><td valign="top" align="left" rowspan="1" colspan="1">0.087206</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">CUDA&#x000a0;MCML</td><td valign="top" align="left" rowspan="1" colspan="1">0.086021</td><td valign="top" align="left" rowspan="1" colspan="1">0.086962</td><td valign="top" align="left" rowspan="1" colspan="1">0.087048</td><td valign="top" align="left" rowspan="1" colspan="1">0.087052</td><td valign="top" align="left" rowspan="1" colspan="1">0.087053</td><td valign="top" align="left" rowspan="1" colspan="1">0.087060</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">TIM&#x02011;OS</td><td valign="top" align="left" rowspan="1" colspan="1">0.087340</td><td valign="top" align="left" rowspan="1" colspan="1">0.087207</td><td valign="top" align="left" rowspan="1" colspan="1">0.087206</td><td valign="top" align="left" rowspan="1" colspan="1">0.087215</td><td valign="top" align="left" rowspan="1" colspan="1">0.087210</td><td valign="top" align="left" rowspan="1" colspan="1">0.087208</td></tr></tbody></table></table-wrap>. When the number of photon larger than 10<sup>8</sup>, the absorbed fraction quickly decreased, which should be incorrect. We first thought that the problem came from the cumulative error in single precision floating point operations, but we did not observe a similar behavior using CUDAMCML, which also used single precision floating point operations.</p><p>In addition to the above studies using the homogeneous problem, we also tested TIM-OS and MMC with a heterogeneous problem provided in the MMC package (mmc/examples/meshtest/sph2.inp). The geometry and optical properties of the problem were detailed as the second example in the MMC paper. In this example, the mesh contained 209,847 tetrahedra. We first compared the two simulators in the static case. While MMC spent 474 seconds to simulate 3 &#x000d7; 10<sup>7</sup> photons, TIM-OS took 82 seconds. In the time-domain simulation, a time window of 0 to 5ns was used with 0.1 ns time step. While MMC spent 440 seconds, TIM-OS took 100 seconds.</p><p>We then test the two solvers with a digital mouse model downloaded from the DIGIMOUSE website [<xref ref-type="bibr" rid="r25">25</xref>]. This digital mouse model contains all the major organs represented in 306,773 tetrahedra. We studied a high absorption case with optical parameters as in the original TIM-OS publication [<xref ref-type="bibr" rid="r7">7</xref>] and a low absorption case by reducing the absorption coefficient of muscle and spleen to 0.05 mm<sup>&#x02212;1</sup>. A pencil beam was placed at (9.8, 41.13, 11.47) mm with the direction (0.873, 0.4364, &#x02212;0.218). Ten million of photons were simulated in each case. As shown in <xref ref-type="table" rid="t005">Table 5</xref>
<table-wrap id="t005" position="float"><label>Table 5</label><caption><title>Absorbed fractions computed with the mouse atlas in the high and low absorption cases</title></caption><table frame="hsides" rules="groups"><col width="19.16%" span="1"/><col width="26.09%" span="1"/><col width="14.28%" span="1"/><col width="27.38%" span="1"/><col width="13.09%" span="1"/><thead><tr><th valign="top" align="left" scope="col" rowspan="1" colspan="1"/><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">High&#x000a0;Absorption&#x000a0;Case<hr/></th><th colspan="2" valign="top" align="center" scope="colgroup" rowspan="1">Low&#x000a0;Absorption&#x000a0;Case<hr/></th></tr><tr><th valign="top" align="left" scope="col" rowspan="1" colspan="1"/><th valign="top" align="left" scope="col" rowspan="1" colspan="1">Absorbed&#x000a0;Fraction</th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">Time</th><th valign="top" align="left" scope="col" rowspan="1" colspan="1">Absorbed&#x000a0;Fraction</th><th valign="top" align="center" scope="col" rowspan="1" colspan="1">Time</th></tr></thead><tbody><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">MMC</td><td valign="top" align="left" rowspan="1" colspan="1">&#x000a0;&#x000a0;&#x000a0;&#x000a0;0.738700</td><td valign="top" align="right" rowspan="1" colspan="1">198</td><td valign="top" align="left" rowspan="1" colspan="1">&#x000a0;&#x000a0;&#x000a0;&#x000a0;0.306610</td><td valign="top" align="right" rowspan="1" colspan="1">314</td></tr><tr><td valign="top" align="left" scope="row" rowspan="1" colspan="1">TIM&#x02011;OS</td><td valign="top" align="left" rowspan="1" colspan="1">&#x000a0;&#x000a0;&#x000a0;&#x000a0;0.738887</td><td valign="top" align="right" rowspan="1" colspan="1">36</td><td valign="top" align="left" rowspan="1" colspan="1">&#x000a0;&#x000a0;&#x000a0;&#x000a0;0.307645</td><td valign="top" align="right" rowspan="1" colspan="1">64</td></tr></tbody></table></table-wrap>, MMC ran about 5 times slower than TIM-OS.</p></sec></sec><sec sec-type="conclusions" id="sec1-4"><title>Discussions and conclusion</title><p>In this article, we have studied several implementation issues for tetrahedron-based inhomogeneous Monte Carlo optical simulation. Our analysis shows that the scheme used in TIM-OS is faster than the Pl&#x000fc;cker coordinate scheme used in MMC. Our experimental comparison shows that TIM-OS is more efficient than MMC. We have also compared TIM-OS with MCML and CUDAMCML for the multi-layered tissue model and found that TIM-OS has the same level of accuracy as MCML and CUDAMCML and a comparable simulation speed as CUDAMCML. While the current MMC program could not solve problems with a refractive index mismatch, a more complete comparison will be done when a new version of MMC is publicly available.</p><p>Given the speed advantage of TIM-OS, we can use an indirect way to support a general mesh. For example, we can partition a hexahedral mesh into a finer tetrahedral mesh and then convert the simulation result on a tetrahedral mesh to that on a general mesh. We believe that this approach should be faster than a directly supported general mesh using the Pl&#x000fc;cker coordinate scheme.</p><p>We have presented a hybrid scheme to support linear Lagrange basis function to represent optical properties and developed an algorithm to determine the photon step size for the linear Lagrange scheme. We then implemented the linear Lagrange scheme in our TIM-OS framework and compared the linear Lagrange scheme with the piece-wise constant scheme (the original TIM-OS). The results show that the piece-wise constant scheme is sufficiently accurate even with a coarse mesh. Since the utility of the linear Lagrange scheme is rather limited, we believe that the piece-wise constant scheme is generally effective and efficient.</p><p>Yet another interesting feature demonstrated in section 3.2 is that TIM-OS can support various real light source types by including environmental material and a lens in a mesh. In the second example, we set up a mesh to include tissue, air, and a spherical lens. The simulator has correctly produced the focusing effect of the lens and the refraction/reflection phenomenon on the tissue surface. Even the mesh is very large and complex (&#x0003e;1 million tetrahedra), TIM-OS does not suffer from any significant speed penalty.</p><p>In conclusion, TIM-OS is superior to MMC in terms of efficiency for the general heterogeneous models, as discussed above. Among optical MC simulators, TIM-OS seems the most efficient one that handles general inhomogeneous geometry. Also, TIM-OS allows users to combine traditional optical simulation and Monte Carlo simulation. Therefore, we believe that TIM-OS will find more applications in the future. A TIM-OS resource is at <ext-link ext-link-type="uri" xlink:href="http://www.imaging.sbes.vt.edu/software/">http://www.imaging.sbes.vt.edu/software/</ext-link>.</p></sec></body><back><ack><title>Acknowledgments</title><p>The work is partially supported by <funding-source rid="sp1">NIH</funding-source> <award-id rid="sp1">R01HL098912</award-id>.</p></ack><app-group><app><title>Appendix A: Photon-Tetrahedron Intersection Test in the TIM-OS scheme</title><p>In this analysis, we assume all the operations, including &#x0201c;+&#x0201d;, &#x0201c;&#x02212;&#x0201d;, &#x0201c;&#x000d7;&#x0201d;, &#x0201c;/&#x0201d;, &#x0201c;IF&#x0201d;, &#x0201c;&#x02265;&#x0201d;, &#x0201c;&#x02264;&#x0201d;, &#x0201c;==&#x0201d;, and &#x0201c;AND&#x0201d;, have the same computational cost. We also ignore the overhead of all &#x0201c;for loops&#x0201d;. Assume <inline-formula><mml:math id="m105"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> to <inline-formula><mml:math id="m106"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mn>4</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> are the four triangles of the tetrahedron, <inline-formula><mml:math id="m107"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the unit normal vector of <inline-formula><mml:math id="m108"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and the unit normal vector points inside the tetrahedron, <inline-formula><mml:math id="m109"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is a constant such that <inline-formula><mml:math id="m110"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>&#x022c5;</mml:mo><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>'</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> for any point <inline-formula><mml:math id="m111"><mml:mrow><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>'</mml:mo></mml:mrow></mml:math></inline-formula> on the plane contains the triangle <inline-formula><mml:math id="m112"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Now, assume <inline-formula><mml:math id="m113"><mml:mrow><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> is the photon position, <inline-formula><mml:math id="m114"><mml:mrow><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>&#x021c0;</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>the unit direction of the photon movement, <italic>t</italic> the step size needed for the photon to reach the intersection point along the photon path. The photon-tetrahedron intersection test in TIM-OS can be represented by the pseudo-code in <xref ref-type="fig" rid="g004">Fig. 4</xref>
<fig id="g004" fig-type="figure" position="anchor"><label>Fig. 4</label><caption><p>Pseudo-code for the photon-tetrahedron intersection test in the TIM-OS scheme.</p></caption><graphic xlink:href="boe-2-1-44-g004"/></fig>. In the best case, in the four triangles only one triangle faces the photon&#x02019;s path. In the worst case, three triangles face the photon&#x02019;s path. Hence, we need about 44 operations on average to perform one photon-tetrahedron intersection test in TIM-OS.</p></app><app><title>Appendix B: Photon-Tetrahedron Intersection Test in the Pl&#x000fc;cker scheme</title><p>The photon-tetrahedron intersection test in Pl&#x000fc;cker Coordinates can be represented by the simplified pseudo-code in <xref ref-type="fig" rid="g005">Fig. 5</xref>
<fig id="g005" fig-type="figure" position="anchor"><label>Fig. 5</label><caption><p>Pseudo-code for the photon-tetrahedron intersection test in the Pl&#x000fc;cker scheme.</p></caption><graphic xlink:href="boe-2-1-44-g005"/></fig>. In this pseudo-code, we ignored the computational cost of the photon&#x02019;s Pl&#x000fc;cker coordinates, i.e. <inline-formula><mml:math id="m116"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. The pseudo-code first computes <inline-formula><mml:math id="m117"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> (<inline-formula><mml:math id="m118"><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:math></inline-formula>) for the selected triangle. If <inline-formula><mml:math id="m119"><mml:mrow><mml:mo>&#x02200;</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&#x02264;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula>, then, it determines the step size (<italic>t</italic>) needed to reach the intersection point. In the best case, the first triangle in the loop will be hit by the photon. In this case, we need at least 50 operations. If the program needs to test with two triangles, then we need at least 75 operations (one of the <inline-formula><mml:math id="m121"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> value can be reused from the previous loop). If the program needs to test with three and four triangles, then we need at least 91 and 96 operations respectively. Then, on average we need at least 78 operations for one photon-tetrahedron intersection test in Pl&#x000fc;cker coordinates.</p></app></app-group><ref-list><title>References and links</title><ref id="r1"><label>1</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>L.</given-names></name><name><surname>Jacques</surname><given-names>S. L.</given-names></name><name><surname>Zheng</surname><given-names>L.</given-names></name></person-group>, &#x0201c;<article-title>MCML--Monte Carlo modeling of light transport in multi-layered tissues</article-title>,&#x0201d; <source>Comput. Methods Programs Biomed.</source> <volume>47</volume>(<issue>2</issue>), <fpage>131</fpage>&#x02013;<lpage>146</lpage> (<year>1995</year>).<pub-id pub-id-type="doi">10.1016/0169-2607(95)01640-F</pub-id><pub-id pub-id-type="pmid">7587160</pub-id></mixed-citation></ref><ref id="r2"><label>2</label><mixed-citation publication-type="confproc">A. Appel, &#x0201c;Some techniques for shading machine renderings of solids,&#x0201d; AFIPS Joint Computer Conferences. Atlantic City, New Jersey (1968).</mixed-citation></ref><ref id="r3"><label>3</label><mixed-citation publication-type="book">J. D. Foley, <italic>Computer Graphics: Principles and Practice</italic>, 2nd ed  (Addison-Wesley, Reading, Mass., 1995).</mixed-citation></ref><ref id="r4"><label>4</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Margallo-Balb&#x000e1;s</surname><given-names>E.</given-names></name><name><surname>French</surname><given-names>P. J.</given-names></name></person-group>, &#x0201c;<article-title>Shape based Monte Carlo code for light transport in complex heterogeneous tissues</article-title>,&#x0201d; <source>Opt. Express</source> <volume>15</volume>(<issue>21</issue>), <fpage>14086</fpage>&#x02013;<lpage>14098</lpage> (<year>2007</year>).<pub-id pub-id-type="doi">10.1364/OE.15.014086</pub-id><pub-id pub-id-type="pmid">19550681</pub-id></mixed-citation></ref><ref id="r5"><label>5</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rice</surname><given-names>B. W.</given-names></name><name><surname>Cable</surname><given-names>M. D.</given-names></name><name><surname>Nelson</surname><given-names>M. B.</given-names></name></person-group>, &#x0201c;<article-title>In vivo imaging of light-emitting probes</article-title>,&#x0201d; <source>J. Biomed. Opt.</source> <volume>6</volume>(<issue>4</issue>), <fpage>432</fpage>&#x02013;<lpage>440</lpage> (<year>2001</year>).<pub-id pub-id-type="doi">10.1117/1.1413210</pub-id><pub-id pub-id-type="pmid">11728202</pub-id></mixed-citation></ref><ref id="r6"><label>6</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cheong</surname><given-names>W. F.</given-names></name><name><surname>Prahl</surname><given-names>S. A.</given-names></name><name><surname>Welch</surname><given-names>A. J.</given-names></name></person-group>, &#x0201c;<article-title>A review of the optical-properties of biological tissues</article-title>,&#x0201d; <source>IEEE J. Quantum Electron.</source> <volume>26</volume>(<issue>12</issue>), <fpage>2166</fpage>&#x02013;<lpage>2185</lpage> (<year>1990</year>).<pub-id pub-id-type="doi">10.1109/3.64354</pub-id></mixed-citation></ref><ref id="r7"><label>7</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shen</surname><given-names>H.</given-names></name><name><surname>Wang</surname><given-names>G.</given-names></name></person-group>, &#x0201c;<article-title>A tetrahedron-based inhomogeneous Monte Carlo optical simulator</article-title>,&#x0201d; <source>Phys. Med. Biol.</source> <volume>55</volume>(<issue>4</issue>), <fpage>947</fpage>&#x02013;<lpage>962</lpage> (<year>2010</year>).<pub-id pub-id-type="doi">10.1088/0031-9155/55/4/003</pub-id><pub-id pub-id-type="pmid">20090182</pub-id></mixed-citation></ref><ref id="r8"><label>8</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>H.</given-names></name><name><surname>Tian</surname><given-names>J.</given-names></name><name><surname>Zhu</surname><given-names>F.</given-names></name><name><surname>Cong</surname><given-names>W.</given-names></name><name><surname>Wang</surname><given-names>L. V.</given-names></name><name><surname>Hoffman</surname><given-names>E. A.</given-names></name><name><surname>Wang</surname><given-names>G.</given-names></name></person-group>, &#x0201c;<article-title>A mouse optical simulation environment (MOSE) to investigate bioluminescent phenomena in the living mouse with the Monte Carlo method</article-title>,&#x0201d; <source>Acad. Radiol.</source> <volume>11</volume>(<issue>9</issue>), <fpage>1029</fpage>&#x02013;<lpage>1038</lpage> (<year>2004</year>).<pub-id pub-id-type="doi">10.1016/j.acra.2004.05.021</pub-id><pub-id pub-id-type="pmid">15350584</pub-id></mixed-citation></ref><ref id="r9"><label>9</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vogt</surname><given-names>W.</given-names></name><name><surname>Shen</surname><given-names>H.</given-names></name><name><surname>Wang</surname><given-names>G.</given-names></name><name><surname>Rylander</surname><given-names>C. G.</given-names></name></person-group>, &#x0201c;<article-title>Parametric study of tissue optical clearing by localized mechanical compression using combined finite element and Monte Carlo simulation</article-title>,&#x0201d; <source>J. Innovative Opt. Health Sci. (JIOHS)</source> <volume>3</volume>(<issue>3</issue>), <fpage>203</fpage>&#x02013;<lpage>211</lpage> (<year>2010</year>).<pub-id pub-id-type="doi">10.1142/S179354581000099X</pub-id></mixed-citation></ref><ref id="r10"><label>10</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lu</surname><given-names>Y.</given-names></name><name><surname>Zhu</surname><given-names>B.</given-names></name><name><surname>Shen</surname><given-names>H.</given-names></name><name><surname>Rasmussen</surname><given-names>J. C.</given-names></name><name><surname>Wang</surname><given-names>G.</given-names></name><name><surname>Sevick-Muraca</surname><given-names>E. M.</given-names></name></person-group>, &#x0201c;<article-title>A parallel adaptive finite element simplified spherical harmonics approximation solver for frequency domain fluorescence molecular imaging</article-title>,&#x0201d; <source>Phys. Med. Biol.</source> <volume>55</volume>(<issue>16</issue>), <fpage>4625</fpage>&#x02013;<lpage>4645</lpage> (<year>2010</year>).<pub-id pub-id-type="doi">10.1088/0031-9155/55/16/002</pub-id><pub-id pub-id-type="pmid">20671350</pub-id></mixed-citation></ref><ref id="r11"><label>11</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rylander</surname><given-names>C. G.</given-names></name><name><surname>Dav&#x000e9;</surname><given-names>D. P.</given-names></name><name><surname>Akkin</surname><given-names>T.</given-names></name><name><surname>Milner</surname><given-names>T. E.</given-names></name><name><surname>Diller</surname><given-names>K. R.</given-names></name><name><surname>Welch</surname><given-names>A. J.</given-names></name></person-group>, &#x0201c;<article-title>Quantitative phase-contrast imaging of cells with phase-sensitive optical coherence microscopy</article-title>,&#x0201d; <source>Opt. Lett.</source> <volume>29</volume>(<issue>13</issue>), <fpage>1509</fpage>&#x02013;<lpage>1511</lpage> (<year>2004</year>).<pub-id pub-id-type="doi">10.1364/OL.29.001509</pub-id><pub-id pub-id-type="pmid">15259729</pub-id></mixed-citation></ref><ref id="r12"><label>12</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yao</surname><given-names>G.</given-names></name><name><surname>Wang</surname><given-names>L. V.</given-names></name></person-group>, &#x0201c;<article-title>Monte Carlo simulation of an optical coherence tomography signal in homogeneous turbid media</article-title>,&#x0201d; <source>Phys. Med. Biol.</source> <volume>44</volume>(<issue>9</issue>), <fpage>2307</fpage>&#x02013;<lpage>2320</lpage> (<year>1999</year>).<pub-id pub-id-type="doi">10.1088/0031-9155/44/9/316</pub-id><pub-id pub-id-type="pmid">10495123</pub-id></mixed-citation></ref><ref id="r13"><label>13</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rylander</surname><given-names>M. N.</given-names></name><name><surname>Feng</surname><given-names>Y.</given-names></name><name><surname>Bass</surname><given-names>J.</given-names></name><name><surname>Diller</surname><given-names>K. R.</given-names></name></person-group>, &#x0201c;<article-title>Heat shock protein expression and injury optimization for laser therapy design</article-title>,&#x0201d; <source>Lasers Surg. Med.</source> <volume>39</volume>(<issue>9</issue>), <fpage>731</fpage>&#x02013;<lpage>746</lpage> (<year>2007</year>).<pub-id pub-id-type="doi">10.1002/lsm.20546</pub-id><pub-id pub-id-type="pmid">17960756</pub-id></mixed-citation></ref><ref id="r14"><label>14</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pfefer</surname><given-names>T. J.</given-names></name><name><surname>Barton</surname><given-names>J. K.</given-names></name><name><surname>Smithies</surname><given-names>D. J.</given-names></name><name><surname>Milner</surname><given-names>T. E.</given-names></name><name><surname>Nelson</surname><given-names>J. S.</given-names></name><name><surname>van Gemert</surname><given-names>M. J.</given-names></name><name><surname>Welch</surname><given-names>A. J.</given-names></name></person-group>, &#x0201c;<article-title>Modeling laser treatment of port wine stains with a computer-reconstructed biopsy</article-title>,&#x0201d; <source>Lasers Surg. Med.</source> <volume>24</volume>(<issue>2</issue>), <fpage>151</fpage>&#x02013;<lpage>166</lpage> (<year>1999</year>).<pub-id pub-id-type="doi">10.1002/(SICI)1096-9101(1999)24:2&#x0003c;151::AID-LSM11&#x0003e;3.0.CO;2-0</pub-id><pub-id pub-id-type="pmid">10100653</pub-id></mixed-citation></ref><ref id="r15"><label>15</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>G.</given-names></name><name><surname>Cong</surname><given-names>W.</given-names></name><name><surname>Durairaj</surname><given-names>K.</given-names></name><name><surname>Qian</surname><given-names>X.</given-names></name><name><surname>Shen</surname><given-names>H.</given-names></name><name><surname>Sinn</surname><given-names>P.</given-names></name><name><surname>Hoffman</surname><given-names>E.</given-names></name><name><surname>McLennan</surname><given-names>G.</given-names></name><name><surname>Henry</surname><given-names>M.</given-names></name></person-group>, &#x0201c;<article-title>In vivo mouse studies with bioluminescence tomography</article-title>,&#x0201d; <source>Opt. Express</source> <volume>14</volume>(<issue>17</issue>), <fpage>7801</fpage>&#x02013;<lpage>7809</lpage> (<year>2006</year>).<pub-id pub-id-type="doi">10.1364/OE.14.007801</pub-id><pub-id pub-id-type="pmid">19529149</pub-id></mixed-citation></ref><ref id="r16"><label>16</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ntziachristos</surname><given-names>V.</given-names></name><name><surname>Ripoll</surname><given-names>J.</given-names></name><name><surname>Wang</surname><given-names>L. V.</given-names></name><name><surname>Weissleder</surname><given-names>R.</given-names></name></person-group>, &#x0201c;<article-title>Looking and listening to light: the evolution of whole-body photonic imaging</article-title>,&#x0201d; <source>Nat. Biotechnol.</source> <volume>23</volume>(<issue>3</issue>), <fpage>313</fpage>&#x02013;<lpage>320</lpage> (<year>2005</year>).<pub-id pub-id-type="doi">10.1038/nbt1074</pub-id><pub-id pub-id-type="pmid">15765087</pub-id></mixed-citation></ref><ref id="r17"><label>17</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Song</surname><given-names>K. H.</given-names></name><name><surname>Stoica</surname><given-names>G.</given-names></name><name><surname>Wang</surname><given-names>L. V.</given-names></name></person-group>, &#x0201c;<article-title>In vivo three-dimensional photoacoustic tomography of a whole mouse head</article-title>,&#x0201d; <source>Opt. Lett.</source> <volume>31</volume>(<issue>16</issue>), <fpage>2453</fpage>&#x02013;<lpage>2455</lpage> (<year>2006</year>).<pub-id pub-id-type="doi">10.1364/OL.31.002453</pub-id><pub-id pub-id-type="pmid">16880853</pub-id></mixed-citation></ref><ref id="r18"><label>18</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rosenthal</surname><given-names>A.</given-names></name><name><surname>Razansky</surname><given-names>D.</given-names></name><name><surname>Ntziachristos</surname><given-names>V.</given-names></name></person-group>, &#x0201c;<article-title>Fast semi-analytical model-based acoustic inversion for quantitative optoacoustic tomography</article-title>,&#x0201d; <source>IEEE Trans. Med. Imaging</source> <volume>29</volume>(<issue>6</issue>), <fpage>1275</fpage>&#x02013;<lpage>1285</lpage> (<year>2010</year>).<pub-id pub-id-type="doi">10.1109/TMI.2010.2044584</pub-id><pub-id pub-id-type="pmid">20304725</pub-id></mixed-citation></ref><ref id="r19"><label>19</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fang</surname><given-names>Q.</given-names></name></person-group>, &#x0201c;<article-title>Mesh-based Monte Carlo method using fast ray-tracing in Pl&#x000fc;cker coordinates.</article-title>,&#x0201d; <source>Biomed. Opt. Express</source> <volume>1</volume>(<issue>1</issue>), <fpage>165</fpage>&#x02013;<lpage>175</lpage> (<year>2010</year>).<pub-id pub-id-type="doi">10.1364/BOE.1.000165</pub-id><pub-id pub-id-type="pmid">21170299</pub-id></mixed-citation></ref><ref id="r20"><label>20</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Platis</surname><given-names>N.</given-names></name><name><surname>Theoharis</surname><given-names>T.</given-names></name></person-group>, &#x0201c;<article-title>Fast ray-tetrahedron intersection using Pl&#x000fc;cker coordinates</article-title>,&#x0201d; <source>J. Graphics GPU Game Tools</source> <volume>8</volume>(<issue>4</issue>), <fpage>37</fpage>&#x02013;<lpage>48</lpage> (<year>2003</year>).</mixed-citation></ref><ref id="r21"><label>21</label><mixed-citation publication-type="webpage">E. Alerstam, T. Svensson, and S. Andersson-Engels, &#x0201c;CUDAMCML, User manual and implementation notes,&#x0201d; Available from <ext-link ext-link-type="uri" xlink:href="http://www.atomic.physics.lu.se/fileadmin/atomfysik/Biophotonics/Software/CUDAMCML.pdf">http://www.atomic.physics.lu.se/fileadmin/atomfysik/Biophotonics/Software/CUDAMCML.pdf</ext-link> (2009).</mixed-citation></ref><ref id="r22"><label>22</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alerstam</surname><given-names>E.</given-names></name><name><surname>Svensson</surname><given-names>T.</given-names></name><name><surname>Andersson-Engels</surname><given-names>S.</given-names></name></person-group>, &#x0201c;<article-title>Parallel computing with graphics processing units for high-speed Monte Carlo simulation of photon migration</article-title>,&#x0201d; <source>J. Biomed. Opt.</source> <volume>13</volume>(<issue>6</issue>), <fpage>060504</fpage> (<year>2008</year>).<pub-id pub-id-type="doi">10.1117/1.3041496</pub-id><pub-id pub-id-type="pmid">19123645</pub-id></mixed-citation></ref><ref id="r23"><label>23</label><mixed-citation publication-type="book">L. A. Piegl, and W. Tiller, <italic>The NURBS Book</italic>, 2nd ed, Monographs in Visual Communications. (Springer, Berlin, 1997).</mixed-citation></ref><ref id="r24"><label>24</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sch&#x000f6;berl</surname><given-names>J.</given-names></name></person-group>, &#x0201c;<article-title>NETGEN: An advancing front 2D/3D-mesh generator based on abstract rules</article-title>,&#x0201d; <source>Comput. Visualization Sci.</source> <volume>1</volume>(<issue>1</issue>), <fpage>41</fpage>&#x02013;<lpage>52</lpage> (<year>1997</year>).<pub-id pub-id-type="doi">10.1007/s007910050004</pub-id></mixed-citation></ref><ref id="r25"><label>25</label><mixed-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dogdas</surname><given-names>B.</given-names></name><name><surname>Stout</surname><given-names>D.</given-names></name><name><surname>Chatziioannou</surname><given-names>A. F.</given-names></name><name><surname>Leahy</surname><given-names>R. M.</given-names></name></person-group>, &#x0201c;<article-title>Digimouse: a 3D whole body mouse atlas from CT and cryosection data</article-title>,&#x0201d; <source>Phys. Med. Biol.</source> <volume>52</volume>(<issue>3</issue>), <fpage>577</fpage>&#x02013;<lpage>587</lpage> (<year>2007</year>).<pub-id pub-id-type="doi">10.1088/0031-9155/52/3/003</pub-id><pub-id pub-id-type="pmid">17228106</pub-id></mixed-citation></ref></ref-list></back></article>
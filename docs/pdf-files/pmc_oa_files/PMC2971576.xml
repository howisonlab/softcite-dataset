<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.0 20120330//EN" "JATS-archivearticle1.dtd">
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="research-article"><?properties open_access?><front><journal-meta><journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id><journal-id journal-id-type="publisher-id">bioinformatics</journal-id><journal-id journal-id-type="hwp">bioinfo</journal-id><journal-title-group><journal-title>Bioinformatics</journal-title></journal-title-group><issn pub-type="ppub">1367-4803</issn><issn pub-type="epub">1367-4811</issn><publisher><publisher-name>Oxford University Press</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmid">20861029</article-id><article-id pub-id-type="pmc">2971576</article-id><article-id pub-id-type="doi">10.1093/bioinformatics/btq540</article-id><article-id pub-id-type="publisher-id">btq540</article-id><article-categories><subj-group subj-group-type="heading"><subject>Applications Note</subject><subj-group><subject>Genome Analysis</subject></subj-group></subj-group></article-categories><title-group><article-title>FastPval: a fast and memory efficient program to calculate very low <italic>P</italic>-values from empirical distribution</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Li</surname><given-names>Mulin Jun</given-names></name><xref ref-type="aff" rid="AFF1"><sup>1</sup></xref></contrib><contrib contrib-type="author"><name><surname>Sham</surname><given-names>Pak Chung</given-names></name><xref ref-type="aff" rid="AFF1"><sup>2</sup></xref></contrib><contrib contrib-type="author"><name><surname>Wang</surname><given-names>Junwen</given-names></name><xref ref-type="aff" rid="AFF1"><sup>1</sup></xref><xref ref-type="corresp" rid="COR1">*</xref></contrib></contrib-group><aff id="AFF1"><sup>1</sup>Department of Biochemistry and <sup>2</sup>Department of Psychiatry and State Key Laboratory of Cognitive and Brain Sciences, LKS Faculty of Medicine, The University of Hong Kong, 21 Sassoon Rd, Pokfulam, Hong Kong SAR, China</aff><author-notes><corresp id="COR1">* To whom correspondence should be addressed.</corresp><fn><p>Associate Editor: Alfonso Valencia</p></fn></author-notes><pub-date pub-type="ppub"><day>15</day><month>11</month><year>2010</year></pub-date><pub-date pub-type="epub"><day>21</day><month>9</month><year>2010</year></pub-date><pub-date pub-type="pmc-release"><day>21</day><month>9</month><year>2010</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. --><volume>26</volume><issue>22</issue><fpage>2897</fpage><lpage>2899</lpage><history><date date-type="received"><day>2</day><month>8</month><year>2010</year></date><date date-type="rev-recd"><day>7</day><month>9</month><year>2010</year></date><date date-type="accepted"><day>16</day><month>9</month><year>2010</year></date></history><permissions><copyright-statement>&#x000a9; The Author(s) 2010. Published by Oxford University Press.</copyright-statement><copyright-year>2010</copyright-year><license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/"><license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/2.5">http://creativecommons.org/licenses/by-nc/2.5</ext-link>), which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p></license></permissions><abstract><p><bold>Motivation:</bold> Resampling methods, such as permutation and bootstrap, have been widely used to generate an empirical distribution for assessing the statistical significance of a measurement. However, to obtain a very low <italic>P</italic>-value, a large size of resampling is required, where computing speed, memory and storage consumption become bottlenecks, and sometimes become impossible, even on a computer cluster.</p><p><bold>Results:</bold> We have developed a multiple stage <italic>P</italic>-value calculating program called FastPval that can efficiently calculate very low (up to 10<sup>&#x02212;9</sup>) <italic>P</italic>-values from a large number of resampled measurements. With only two input files and a few parameter settings from the users, the program can compute <italic>P</italic>-values from empirical distribution very efficiently, even on a personal computer. When tested on the order of 10<sup>9</sup> resampled data, our method only uses 52.94% the time used by the conventional method, implemented by standard quicksort and binary search algorithms, and consumes only 0.11% of the memory and storage. Furthermore, our method can be applied to extra large datasets that the conventional method fails to calculate. The accuracy of the method was tested on data generated from Normal, Poison and Gumbel distributions and was found to be no different from the exact ranking approach.</p><p><bold>Availability:</bold> The FastPval executable file, the java GUI and source code, and the java web start server with example data and introduction, are available at <ext-link ext-link-type="uri" xlink:href="http://wanglab.hku.hk/pvalue">http://wanglab.hku.hk/pvalue</ext-link></p><p><bold>Contact:</bold> <email>junwen@hku.hk</email></p><p><bold>Supplementary information:</bold> <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq540/DC1">Supplementary data</ext-link> are available at <italic>Bioinformatics</italic> online and <ext-link ext-link-type="uri" xlink:href="http://wanglab.hku.hk/pvalue/">http://wanglab.hku.hk/pvalue/</ext-link>.</p></abstract></article-meta></front><body><sec sec-type="intro" id="SEC1"><title>1 INTRODUCTION</title><p>Permutation and bootstrap are resampling procedures to assess the statistical significance of a measurement. They are non-parametric statistical tests that can convert a measurement (score) into an empirical <italic>P</italic>-value, even when the distribution of the measurements is unknown. Since resampling does not assume known distribution of the data, and biological data are usually complex, it has been widely used in the bioinformatics field, such as transcription factor binding site searching, pathway analysis and genome-wide association studies.</p><p>Finding transcription factor binding sites (TFBSs) in the promoter region of a gene is important to understand gene regulation (Zhang <italic>et al.</italic>, <xref ref-type="bibr" rid="B4">2007</xref>). TFBS of a particular transcription factor are usually represented by a computational model known as the position weight matrix (PWM) (Pape <italic>et al.</italic>, <xref ref-type="bibr" rid="B3">2008</xref>). To search for a putative binding site, we use the PWM to score DNA sequences with a sliding window approach. For each window, we obtain a score. By comparing this score with the distribution of the scores from the background, we can obtain the statistical significance (empirical <italic>P</italic>-value) of this score. The empirical background score distribution is obtained by scoring a large set of random sequences from the intergenic regions in the genome with the same PWM. We then sort the background scores and save them for later usage. When we convert a new score into a <italic>P</italic>-value, we load the background into the memory and search for the score. The ranking of the score is then converted to a <italic>P</italic>-value (Hannenhalli, <xref ref-type="bibr" rid="B1">2008</xref>).</p><p>This empirical approach of calculating <italic>P</italic>-values is very powerful since it does not assume any distribution of the data. However, the significance of the <italic>P</italic>-value is limited by the size of the background we sample. To obtain a very low <italic>P</italic>-value, we have to sample a very large dataset from the background. The large dataset causes three limitations: (i) sorting and searching in a large dataset are time consuming; (ii) storage of the sorted background scores requires a large amount of hard disk space; and (iii) processing of the sorted array requires a great deal of memory, which is not usually feasible on a personal computer.</p><p>Efficient methods have been developed to relieve the computational burden resulting from large-scale resampling. For example, Jensen <italic>et al.</italic> (<xref ref-type="bibr" rid="B2">2009</xref>) developed a Bayesian approach to dynamically assign resamples for multiple testing problems. For microarray expression data, they assume that each gene has a different null distribution, and allocate more resamples to the genes with <italic>P</italic>-values close to the classification threshold. But for the <italic>P</italic>-values that are far lower or far higher than the threshold and the decisions that are easy to make, they allocate much fewer resamples than the traditional method. The dynamic resampling allocation strategy has improved the computing efficiency, particularly when the number of tests is large.</p><p>While the above mentioned method deals with the efficiency of multiple tests, assuming each test has a different null distribution, <italic>P</italic>-value calculation from resampling based on a single test, or multiple tests assuming the same null distribution, is still hampered by computing, memory and storage limitations.</p><p>We have developed an efficient program to calculate the empirical <italic>P</italic>-value for a single test, or multiple tests assuming the same null distribution. This program separates the background distribution into multiple parts, according to user specified cutoffs. The scores in the less significant part are highly condensed into one table and the <italic>P</italic>-values are calculated less exactly, while the scores in the more significant part are put into other tables and the <italic>P</italic>-values are calculated more accurately. Our experiments showed that this algorithm is more time efficient, and uses much less storage and memory. It can be used widely in resampling based <italic>P</italic>-value calculation, either as standalone software or as a plug-in module.</p></sec><sec sec-type="methods" id="SEC2"><title>2 METHODS</title><p>For simplicity, here we illustrate our method in a two-stage approach and use the right tail of the distribution to calculate the statistics. In the first stage, we randomly sample a subset <italic>N</italic> from the original large dataset O. N is usually less than one-hundredth of the size of <italic>O</italic>, thus saving processing time. We sort N and obtain a cutoff score <italic>S</italic><sub><italic>c</italic></sub> representing the top P portion of <italic>N</italic>. Both <italic>N</italic> and <italic>P</italic> are parameters specified by the users, and are set to <italic>N</italic> = 100 000 and <italic>P</italic> = 0.001 by the default. We then scan the original set and put scores greater than <italic>S</italic><sub><italic>c</italic></sub> into our second subset <italic>M</italic>, and we obtain the maximum score <italic>S</italic><sub><italic>m</italic></sub> in <italic>M</italic>. The two subsets <italic>N</italic> and <italic>M</italic> are sorted, saved, and serve as our two models (<italic>M</italic>1 and <italic>M</italic>2). To calculate the <italic>P</italic>-value for a new score <italic>S</italic>, we compare <italic>S</italic> with <italic>S</italic><sub><italic>c</italic></sub>. If <italic>S</italic> &#x02264; <italic>S</italic><sub><italic>c</italic></sub>, we will find its <italic>P</italic>-value in <italic>M</italic>1. Otherwise we use <italic>M</italic>2. If <italic>S</italic> &#x0003e; <italic>S</italic><sub><italic>m</italic></sub>, indicating <italic>S</italic> is out of our resampling score range, we use theoretical distribution to calculate its <italic>P</italic>-value or simply set the <italic>P</italic>-value to 0, at the user's preference. The parameters of two theoretical distributions, normal and extreme value distributions, were obtained from dataset <italic>N</italic>.</p><p>To evaluate the performance of our method, we compared FastPval with the traditional approach (named Exact) on a linux machine (Intel Xeon CPU E5410 2.33 GHz; 16 G of memory, SuSE linux 10.1). In the &#x02018;Exact&#x02019; approach, we used quicksort and binary search in c programming. FastPval used the same sorting and searching algorithms for <italic>M</italic>1 and <italic>M</italic>2.</p><p>To evaluate the accuracy of FastPval, we compared the calculated <italic>P</italic>-values with the original <italic>P</italic>-values in three different distributions: Normal, Poisson and Gumbel. For each distribution, we tested the <italic>P</italic>-values in the &#x02212;log<sub>10</sub>(<italic>P</italic>-value) ranged from 0 to 9 (corresponding <italic>P</italic>-value range from 1 to 10<sup>&#x02212;9</sup>, exclusively). We took 162 <italic>P</italic>-values (termed theoretical <italic>P</italic>-values) evenly distributed in each of the nine ranges (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq540/DC1">Supplementary Table S1</ext-link>). We converted these <italic>P</italic>-values into scores with the build-in functions in the R platform, using parameters for each distribution as shown in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq540/DC1">Supplementary Table S2</ext-link>. Under the same parameter setting, we randomly sampled one billion data points. We used FastPval to build models <italic>M</italic>1 and <italic>M</italic>2 from these data. Finally, we used FastPval to convert these 162 scores into <italic>P</italic>-values (termed FastPval <italic>P</italic>-values) with the models. The &#x02212;log<sub>10</sub> (FastPval <italic>P</italic>-values) were plotted against the &#x02212;log<sub>10</sub> (theoretical <italic>P</italic>-values) on a Log&#x02013;Log QQ plot. The Kolmogorov--Smirnov test was also used to compare the FastPval <italic>P</italic>-values with theoretical <italic>P</italic>-values.</p></sec><sec id="SEC3"><title>3 RESULTS AND DISCUSSION</title><p>As shown in <xref ref-type="table" rid="T1">Table 1</xref>, FastPval shows significant improvement over the &#x02018;Exact&#x02019; approach. Tested on 1 billion resampling data, FastPval only used 0.11% of the memory and storage and 52.94% of model building and searching times. When we increased the dataset size to 5 billion, the &#x02018;Exact&#x02019; method failed to load due to the large memory requirement, while our method was able to calculate <italic>P</italic>-values successfully. FastPval has speed, memory and storage consumption approximately linear to resembling size. The accuracies of FastPval calculated <italic>P</italic>-values from three different distributions were compared with the theoretical <italic>P</italic>-values. The results are shown in the form of Log&#x02013;Log QQ plots (<ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq540/DC1">Supplementary Fig. S1a&#x02013;c</ext-link>). In all three tested distributions, the FastPval calculated <italic>P</italic>-values and the theoretical <italic>P</italic>-values are highly matched, forming a 45 degree line in the Log&#x02013;Log QQ plots. The Kolmogorov&#x02013;Smirnov tests showed the <italic>P</italic>-value = 1.000 for Normal and Poisson distributions, and 0.998 for Gumbel distribution, indicating that the calculated <italic>P</italic>-values did not deviate from the original distribution. We therefore conclude that FastPval is accurate for calculating <italic>P</italic>-values for data from a variety of distributions.
<table-wrap id="T1" position="float"><label>Table 1.</label><caption><p>Comparison of FastPval and Exact method in memory, storage consumptions and running time</p></caption><table frame="hsides" rules="groups"><thead align="left"><tr><th rowspan="1" colspan="1">Resampling size (1 000 000)</th><th colspan="2" rowspan="1">Memory(MB)<hr/></th><th colspan="2" rowspan="1">Storage (MB)<hr/></th><th colspan="4" rowspan="1">Running time (s)<hr/></th></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1"/><th colspan="2" rowspan="1">Model building<hr/></th><th colspan="2" rowspan="1"><italic>P</italic>-value searching<xref ref-type="table-fn" rid="TF1"><sup>a</sup></xref><hr/></th></tr><tr><th rowspan="1" colspan="1"/><th rowspan="1" colspan="1">Exact</th><th rowspan="1" colspan="1">FastPval</th><th rowspan="1" colspan="1">Exact</th><th rowspan="1" colspan="1">FastPval<xref ref-type="table-fn" rid="TF2"><sup>b</sup></xref></th><th rowspan="1" colspan="1">Exact</th><th rowspan="1" colspan="1">FastPval</th><th rowspan="1" colspan="1">Exact</th><th rowspan="1" colspan="1">FastPval</th></tr></thead><tbody align="left"><tr><td rowspan="1" colspan="1">1</td><td rowspan="1" colspan="1">4</td><td rowspan="1" colspan="1">0.39</td><td rowspan="1" colspan="1">12.1</td><td rowspan="1" colspan="1">1.3 + 0.013</td><td rowspan="1" colspan="1">1.10</td><td rowspan="1" colspan="1">1.05</td><td rowspan="1" colspan="1">0.74 + 2.33</td><td rowspan="1" colspan="1">0.08 + 1.53</td></tr><tr><td rowspan="1" colspan="1">10</td><td rowspan="1" colspan="1">38</td><td rowspan="1" colspan="1">0.39</td><td rowspan="1" colspan="1">121.4</td><td rowspan="1" colspan="1">1.3 + 0.131</td><td rowspan="1" colspan="1">11.21</td><td rowspan="1" colspan="1">9.29</td><td rowspan="1" colspan="1">7.61 + 29.88</td><td rowspan="1" colspan="1">0.09 + 16.07</td></tr><tr><td rowspan="1" colspan="1">100</td><td rowspan="1" colspan="1">373</td><td rowspan="1" colspan="1">0.78</td><td rowspan="1" colspan="1">1200</td><td rowspan="1" colspan="1">1.3 + 1.3</td><td rowspan="1" colspan="1">116.73</td><td rowspan="1" colspan="1">91.46</td><td rowspan="1" colspan="1">77.13 + 332.13</td><td rowspan="1" colspan="1">0.14 + 249.44</td></tr><tr><td rowspan="1" colspan="1">500</td><td rowspan="1" colspan="1">1900</td><td rowspan="1" colspan="1">2</td><td rowspan="1" colspan="1">5900</td><td rowspan="1" colspan="1">1.3 + 6.0</td><td rowspan="1" colspan="1">677.58</td><td rowspan="1" colspan="1">455.23</td><td rowspan="1" colspan="1">380.47 + 1885.12</td><td rowspan="1" colspan="1">0.40 + 1297.44</td></tr><tr><td rowspan="1" colspan="1">1000</td><td rowspan="1" colspan="1">3700</td><td rowspan="1" colspan="1">4</td><td rowspan="1" colspan="1">11 900</td><td rowspan="1" colspan="1">1.3 + 11.9</td><td rowspan="1" colspan="1">1409.61</td><td rowspan="1" colspan="1">919.45</td><td rowspan="1" colspan="1">761.52 + 4019.77</td><td rowspan="1" colspan="1">0.72 + 2530.65</td></tr><tr><td rowspan="1" colspan="1">5000</td><td rowspan="1" colspan="1">N/A<sup>c</sup></td><td rowspan="1" colspan="1">19</td><td rowspan="1" colspan="1">59 900</td><td rowspan="1" colspan="1">1.3 + 59.8</td><td rowspan="1" colspan="1">N/A<xref ref-type="table-fn" rid="TF3"><sup>c</sup></xref></td><td rowspan="1" colspan="1">5475.32</td><td rowspan="1" colspan="1">N/A<xref ref-type="table-fn" rid="TF3"><sup>c</sup></xref></td><td rowspan="1" colspan="1">3.34 + 12885.87</td></tr></tbody></table><table-wrap-foot><fn id="TF1"><p><sup>a</sup>Model loading + searching time.</p></fn><fn id="TF2"><p><sup>b</sup>Sizes of first model + second model.</p></fn><fn id="TF3"><p><sup>c</sup>Exact method failed to load due to large size of the dataset.</p></fn></table-wrap-foot></table-wrap>
</p><p>The Java GUI interface of FastPval is shown in <ext-link ext-link-type="uri" xlink:href="http://bioinformatics.oxfordjournals.org/cgi/content/full/btq540/DC1">Supplementary Figure S2a&#x02013;c</ext-link>. In the &#x02018;Method&#x02019; field, the user can either choose &#x02018;FastPval&#x02019; or the traditional &#x02018;Exact&#x02019; method to calculate <italic>P</italic>-values. When the resembling size is greater than 10 million, FastPval is the only suitable choice. In the &#x02018;Step&#x02019; field, the user can either &#x02018;Generate model&#x02019;, or &#x02018;Calculate <italic>P</italic>-value&#x02019; or &#x02018;Do both&#x02019;. The &#x02018;Generate model&#x02019; step allows the user to generate <italic>M</italic>1 and <italic>M</italic>2 models from the background dataset <italic>O</italic>; the &#x02018;Calculate <italic>P</italic>-value&#x02019; step allows the user to calculate <italic>P</italic>-values for all the scores saved in a text file. The interface changes according to the user&#x02019;s selection. In the &#x02018;Generate model&#x02019; step, the user has to specify the background file and directory to save two models, by clicking on &#x02018;Background file&#x02019; and &#x02018;Output folder&#x02019;, respectively. The user also needs to select two parameters, the &#x02018;Sampling size&#x02019; (<italic>N</italic>) and &#x02018;<italic>P</italic>-value cutoff&#x02019; (<italic>P</italic>). The selections of <italic>P</italic> and <italic>N</italic> are affected by the balance of accuracy and speed. Bigger <italic>N</italic>s and <italic>P</italic>s will give more accurate <italic>P</italic>-values but will be less efficient. We recommend <italic>N</italic> = 100 000 and <italic>P</italic> = 0.001. <italic>N</italic><sup>*</sup><italic>P</italic> should be within the range of 10 to 1000, preferably 100. After the models are generated, the program will automatically change to the &#x02018;Calculate <italic>P</italic>-value&#x02019; step, with default model files selected. The user will need to specify the file with scores for <italic>P</italic>-value calculation, by clicking on &#x02018;Sample file&#x02019;. For scores that are out of the boundary of both models, the user can choose either &#x02018;Extreme distribution&#x02019; or &#x02018;Normal distribution&#x02019; in the &#x02018;Assumed distribution&#x02019; field to calculate the <italic>P</italic>-value, or simply select &#x02018;No distribution&#x02019; to assign the <italic>P</italic>-value to 0. The parameters of both distributions were calculated from the fitting of the dataset <italic>N</italic>.</p><p>The program can be run in a command line mode, which is suitable for large-scale batch processing. We provide both 32-bit and 64-bit executable GUI programs, in both linux and windows platforms. The source code of the program is provided in our companion website.</p><p><italic>Funding</italic>: Internal funds from the CRCG and the Genomic SRT of the University of Hong Kong; GRF 778609M and AoE M-04/04 from the Research Grants Council of Hong Kong.</p><p><italic>Conflict of Interest</italic>: none declared.</p></sec>
      <sec sec-type="supplementary-material">
         <title>Supplementary Material</title>
         <supplementary-material id="PMC_1" content-type="local-data">
            <caption>
               <title>Supplementary Data</title>
            </caption>
            <media mimetype="text" mime-subtype="html" xlink:href="supp_26_22_2897__index.html"/>
            <media xlink:role="associated-file" mimetype="application" mime-subtype="msword"
                   xlink:href="supp_btq540_fastpval_supp.docx"/>
         </supplementary-material>
      </sec>
   </body><back><ref-list><title>REFERENCES</title><ref id="B1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hannenhalli</surname><given-names>S</given-names></name></person-group><article-title>Eukaryotic transcription factor binding sites&#x02013;-modeling and integrative search methods</article-title><source>Bioinformatics</source><year>2008</year><volume>24</volume><fpage>1325</fpage><lpage>1331</lpage><pub-id pub-id-type="pmid">18426806</pub-id></element-citation></ref><ref id="B2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jensen</surname><given-names>ST</given-names></name><etal/></person-group><article-title>A Bayesian approach to efficient differential allocation for resampling-based significance testing</article-title><source>BMC Bioinformatics</source><year>2009</year><volume>10</volume><fpage>198</fpage><pub-id pub-id-type="pmid">19558706</pub-id></element-citation></ref><ref id="B3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pape</surname><given-names>UJ</given-names></name><etal/></person-group><article-title>Natural similarity measures between position frequency matrices with an application to clustering</article-title><source>Bioinformatics</source><year>2008</year><volume>24</volume><fpage>350</fpage><lpage>357</lpage><pub-id pub-id-type="pmid">18174183</pub-id></element-citation></ref><ref id="B4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>J</given-names></name><etal/></person-group><article-title>Computing exact P-values for DNA motifs</article-title><source>Bioinformatics</source><year>2007</year><volume>23</volume><fpage>531</fpage><lpage>537</lpage><pub-id pub-id-type="pmid">17237046</pub-id></element-citation></ref></ref-list></back></article>
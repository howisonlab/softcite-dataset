{
    "level": "paragraph",
    "abstract": [
        {
            "text": "Techniques for performing model-independent searches for direct CP violation in three and four-body decays are discussed. Comments on the performance and the optimisation of a binned \u03c7 2 approach and an unbinned approach, known as the energy test, are made. The use of the energy test in the presence of background is also studied. The selection and treatment of the coordinates used to describe the phase-space of the decay are discussed. The conventional model-independent techniques, which test for P -even CP violation, are modified to create a new approach for testing for P -odd CP violation. An implementation of the energy test using GPUs is described.",
            "paragraph_rank": 1,
            "section_rank": 1
        }
    ],
    "body_text": [
        {
            "text": "Introduction",
            "section_rank": 2
        },
        {
            "section": "Introduction",
            "text": "The study of Charge-Parity (CP ) violation allows for a sensitive probe of new physics from beyond the Standard Model of particle physics. CP violation is incorporated in the Standard Model of particle physics through a complex phase in the Cabibbo-Kobayashi-Maskawa (CKM) matrix [1]. Contributions from new particles, at mass scales that cannot be directly probed, can enhance the amount of CP violation observed. This paper discusses model-independent searches for direct CP violation, i.e. CP violation in decays, in multi-body final states. The rich phase-space of interfering resonances in multi-body decays provides excellent opportunities for CP violation measurements. Two techniques that have been used in the literature are discussed in Sect. 2. These are a binned \u03c7 2 test and an unbinned technique based on the average weighted distance between events in phase-space known as the energy test. The performance and optimisation of these techniques is discussed. An approach to study CP violation in the presence of background events using unbinned techniques is presented in Sect. 3 through the extension of the energy test formalism.",
            "paragraph_rank": 2,
            "section_rank": 2,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b0",
                    "start": 280,
                    "text": "[1]",
                    "end": 283
                }
            ]
        },
        {
            "section": "Introduction",
            "text": "The selection of the coordinates used for analysing the CP violation are discussed in Sect. 4. A novel method for analysing P -odd CP violation, which is accessible in any decay for which a parity violating observable can be defined such as decays to four pseudo-scalar particles, is presented in Sect. 5. This method is applicable for use with any two sample comparison test. The first application of this technique [2], using the energy test to compare the samples, has given rise to a result 2.7\u03c3 away from the no-CP violation hypothesis.",
            "paragraph_rank": 3,
            "section_rank": 2,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b4",
                    "start": 303,
                    "text": "5",
                    "end": 304
                },
                {
                    "type": "bibr",
                    "ref_id": "b1",
                    "start": 417,
                    "text": "[2]",
                    "end": 420
                }
            ]
        },
        {
            "section": "Introduction",
            "text": "The implementation of the energy test method in a computationally efficient manner using GPUs is discussed in Sect. 6.",
            "paragraph_rank": 4,
            "section_rank": 2
        },
        {
            "text": "Techniques",
            "section_rank": 3
        },
        {
            "section": "Techniques",
            "text": "Model-independent searches for direct CP violation have been carried out using a number of different techniques. Tests have often been performed using a binned \u03c7 2 approach to compare the relative density in the Dalitz plot [3] of a decay and its CP -conjugate sample (see for example [4] for three-body and [5] for a generalisation to the phase-space of fourbody decays). This method is discussed further below. More recently unbinned techniques have also been applied. A technique known as the energy test has been applied (see [6] for three-body and [2] for four-body), again this is discussed below. A nearest neighbours approach has been used in Ref. [7], albeit with a very small number of neighbours, and the angular moments of the cosine of the helicity angle of the studied particle have also been utilised [4] in three-body decays. A class of measurements based on triple products of momenta in four-body meson decays have also been performed [8]. The P -odd CP violation test proposed in Sect. 5 is related to these. P -odd CP violation can also be accessed in the baryon sector owing to significant P -parity violation even in two-body decays of baryons. This type of CP asymmetry can be measured by comparing P asymmetries for baryon and anti-baryon decays [9].",
            "paragraph_rank": 5,
            "section_rank": 3,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b2",
                    "start": 224,
                    "text": "[3]",
                    "end": 227
                },
                {
                    "type": "bibr",
                    "ref_id": "b3",
                    "start": 285,
                    "text": "[4]",
                    "end": 288
                },
                {
                    "type": "bibr",
                    "ref_id": "b4",
                    "start": 308,
                    "text": "[5]",
                    "end": 311
                },
                {
                    "type": "bibr",
                    "ref_id": "b5",
                    "start": 530,
                    "text": "[6]",
                    "end": 533
                },
                {
                    "type": "bibr",
                    "ref_id": "b1",
                    "start": 553,
                    "text": "[2]",
                    "end": 556
                },
                {
                    "type": "bibr",
                    "ref_id": "b6",
                    "start": 656,
                    "text": "[7]",
                    "end": 659
                },
                {
                    "type": "bibr",
                    "ref_id": "b3",
                    "start": 816,
                    "text": "[4]",
                    "end": 819
                },
                {
                    "type": "bibr",
                    "ref_id": "b7",
                    "start": 953,
                    "text": "[8]",
                    "end": 956
                },
                {
                    "type": "bibr",
                    "ref_id": "b8",
                    "start": 1270,
                    "text": "[9]",
                    "end": 1273
                }
            ]
        },
        {
            "text": "Binned \u03c7 2",
            "section_rank": 4
        },
        {
            "section": "Binned \u03c7 2",
            "text": "The simplest and most commonly applied technique used in the literature, here referred to as S CP [4,10], is a two-sample binned \u03c7 2 test. The phase-space is divided into bins. The statistical significance of the difference in number of entries in the bin for the X andX samples is computed.",
            "paragraph_rank": 6,
            "section_rank": 4,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b3",
                    "start": 98,
                    "text": "[4,",
                    "end": 101
                },
                {
                    "type": "bibr",
                    "ref_id": "b9",
                    "start": 101,
                    "text": "10]",
                    "end": 104
                }
            ]
        },
        {
            "section": "Binned \u03c7 2",
            "text": "where N i (X) and N i (X) are the numbers of X andX candidates in the i th bin, and the N i values are sufficiently large that Gaussian uncertainties may be assumed. \u03b1 is the ratio between the total yield of X andX events. The parameter \u03b1 is introduced to account for global asymmetries which may occur due to production effects. The small correction to the significance term in the denominator varies in the literature [4,5] where the form given here is recommended.",
            "paragraph_rank": 7,
            "section_rank": 4,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b3",
                    "start": 420,
                    "text": "[4,",
                    "end": 423
                },
                {
                    "type": "bibr",
                    "ref_id": "b4",
                    "start": 423,
                    "text": "5]",
                    "end": 425
                }
            ]
        },
        {
            "section": "Binned \u03c7 2",
            "text": "In the absence of local CP asymmetries the S i CP are distributed according to a Gaussian of unit width and zero mean. The \u03c7 2 test value is computed from \u03c7 2 = (S i CP ) 2 . The corresponding p-value for the compatibility of the observed data with the no CP violation hypothesis can be computed directly from the observed \u03c7 2 value and the number of degrees of freedom; here equal to number of bins\u22121. The test is straightforward to implement and requires only minimal computing resources.",
            "paragraph_rank": 8,
            "section_rank": 4
        },
        {
            "section": "Binned \u03c7 2",
            "text": "The number, size and location of the bins need to be selected by the analysts. General advice for \u03c7 2 comparison tests is that the number of bins must be sufficient not to miss local regions of asymmetry but limited to ensure sufficient numbers of entries in the bins to not affect the sensitivity.",
            "paragraph_rank": 9,
            "section_rank": 4
        },
        {
            "section": "Binned \u03c7 2",
            "text": "The number of bins used in the method in the literature have varied significantly. The initial application and discussion of the method [4,10] divided the Dalitz plane into O(10 3 ) bins. Applications of the method have also used a smaller number of bins, O (10) to O(10 2 ) [5,11].",
            "paragraph_rank": 10,
            "section_rank": 4,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b3",
                    "start": 136,
                    "text": "[4,",
                    "end": 139
                },
                {
                    "type": "bibr",
                    "ref_id": "b9",
                    "start": 139,
                    "text": "10]",
                    "end": 142
                },
                {
                    "type": "bibr",
                    "ref_id": "b9",
                    "start": 258,
                    "text": "(10)",
                    "end": 262
                },
                {
                    "type": "bibr",
                    "ref_id": "b4",
                    "start": 275,
                    "text": "[5,",
                    "end": 278
                },
                {
                    "type": "bibr",
                    "ref_id": "b10",
                    "start": 278,
                    "text": "11]",
                    "end": 281
                }
            ]
        },
        {
            "section": "Binned \u03c7 2",
            "text": "We recommend that the number of bins used in the method should be kept to a relatively small number. The number of degrees of freedom increases for every additional bin used and consequently the sensitivity of the method is decreased. This is illustrated in Fig. 1, where the increased sensitivity of using a smaller number of bins is clearly observed. In this study simulation samples of 100,000 events were generated using the analysis package Laura++ [12] according to the simple model in Ref. [13]. CP violation was introduced by changing the amplitude of the resonance with the largest fraction in that model. In a binned approach there is a clear trade-off between minimising the number of bins used and retaining sensitivity to the rich phase-space of interfering amplitudes in the decay. This is particularly true in the case of four-body decays where five coordinates are required to describe the phase-space (see Sect. 4).",
            "paragraph_rank": 11,
            "section_rank": 4,
            "ref_spans": [
                {
                    "type": "figure",
                    "start": 258,
                    "text": "Fig. 1",
                    "end": 264
                },
                {
                    "type": "bibr",
                    "ref_id": "b11",
                    "start": 454,
                    "text": "[12]",
                    "end": 458
                },
                {
                    "type": "bibr",
                    "ref_id": "b12",
                    "start": 497,
                    "text": "[13]",
                    "end": 501
                }
            ]
        },
        {
            "section": "Binned \u03c7 2",
            "text": "Binned distributions of the CP asymmetry in the phase-space can also be used to test for CP violation. This technique was successfully applied in [14,15]  Figure 1: p-value versus number of bins in S CP method for simulation samples with CP violation introduced at the (left) 3% and (right) 5% level in one amplitude (see text). 1000 samples were generated and the mean p-values are shown by the points and the one-sigma confidence level range indicated by the yellow-band.",
            "paragraph_rank": 12,
            "section_rank": 4,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b13",
                    "start": 146,
                    "text": "[14,",
                    "end": 150
                },
                {
                    "type": "bibr",
                    "ref_id": "b14",
                    "start": 150,
                    "text": "15]",
                    "end": 153
                }
            ]
        },
        {
            "section": "Binned \u03c7 2",
            "text": "asymmetries in B + \u2192 h + h + h \u2212 decays with h = \u03c0, K. In this application of O(10 2 ) bins were used. The placement of the bins was physically motivated by the observed location of the resonances. The bin sizes varied across the plane to equalise the number of entries in each bin.",
            "paragraph_rank": 13,
            "section_rank": 4
        },
        {
            "text": "Energy test",
            "section_rank": 5
        },
        {
            "section": "Energy test",
            "text": "A wide range of unbinned two sample tests exist in the literature [16]. Well-known examples include the nearest neighbour approach, which has previously been applied to CP violation tests [7], and multi-dimensional extensions of the Kolmogorov-Smirnov test, commonly used in the astronomy literature [17]. The former has previously been shown to be relatively insensitive for this class of problem [18] and studies by the authors have concluded similarly for the latter. The class of multi-variate tests based on distances between observables are of particular interest. A statistical method called the energy test was introduced in Refs. [19,20]. Reference [13] suggests applying this method to Dalitz plot analyses and demonstrates the potential to obtain improved sensitivity to CP violation over the standard binned approach. The distribution of the test statistic is not known, and the permutation method is required to be applied in order to determine the significance of a result. This method was applied in [6] and is described below and used in the studies in this paper. Many other tests of this class are known, including cases where the exact distribution is known under the null-hypothesis, and hence no permutations would be required (e.g. Cross-match statistic test [21]).",
            "paragraph_rank": 14,
            "section_rank": 5,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b15",
                    "start": 66,
                    "text": "[16]",
                    "end": 70
                },
                {
                    "type": "bibr",
                    "ref_id": "b6",
                    "start": 188,
                    "text": "[7]",
                    "end": 191
                },
                {
                    "type": "bibr",
                    "ref_id": "b16",
                    "start": 300,
                    "text": "[17]",
                    "end": 304
                },
                {
                    "type": "bibr",
                    "ref_id": "b17",
                    "start": 398,
                    "text": "[18]",
                    "end": 402
                },
                {
                    "type": "bibr",
                    "ref_id": "b18",
                    "start": 639,
                    "text": "[19,",
                    "end": 643
                },
                {
                    "type": "bibr",
                    "ref_id": "b19",
                    "start": 643,
                    "text": "20]",
                    "end": 646
                },
                {
                    "type": "bibr",
                    "ref_id": "b12",
                    "start": 658,
                    "text": "[13]",
                    "end": 662
                },
                {
                    "type": "bibr",
                    "ref_id": "b5",
                    "start": 1015,
                    "text": "[6]",
                    "end": 1018
                },
                {
                    "type": "bibr",
                    "ref_id": "b20",
                    "start": 1281,
                    "text": "[21]",
                    "end": 1285
                }
            ]
        },
        {
            "section": "Energy test",
            "text": "In the energy test method a test statistic, T , is used to compare average distances in phase-space, based on a distance function, \u03c8 ij , of pairs of events ij belonging to two samples. In the standard test the two samples are those of different flavours, particle and anti-particle. The test statistic is defined as",
            "paragraph_rank": 15,
            "section_rank": 5
        },
        {
            "section": "Energy test",
            "text": "where the first and second terms correspond to a weighted average distance of events within the n events of the first sample and the n events of the second sample, respectively. The third term measures the weighted average distance of events in one flavour sample to events of the opposite flavour sample. The normalisation factors in the denominator remove the impact of global asymmetries between the two samples.",
            "paragraph_rank": 16,
            "section_rank": 5
        },
        {
            "section": "Energy test",
            "text": "If the distributions of events in both samples are identical the measured T value will fluctuate around a value close to zero; differences between these distributions increase the value of T . This is translated into a p-value under the hypothesis of CP symmetry by comparing the measured T value to a distribution of T values obtained from permutation samples. The permutation samples are constructed by randomly assigning events to either of the samples, thus simulating a situation without CP violation. The p-value for the no-CP -violation hypothesis is obtained as the fraction of permutation T values greater than the observed T value.",
            "paragraph_rank": 17,
            "section_rank": 5
        },
        {
            "section": "Energy test",
            "text": "If large CP violation is observed, the observed T value is likely to lie outside the range of permutation T values. In this case the permutation T distribution can be fitted with a generalised-extreme-value (GEV) function, as demonstrated in Refs. [19,20] and used in Ref. [2,6]. The p-value from the fitted T distribution can be calculated as the fraction of the integral of the function above the observed T value.",
            "paragraph_rank": 18,
            "section_rank": 5,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b18",
                    "start": 248,
                    "text": "[19,",
                    "end": 252
                },
                {
                    "type": "bibr",
                    "ref_id": "b19",
                    "start": 252,
                    "text": "20]",
                    "end": 255
                },
                {
                    "type": "bibr",
                    "ref_id": "b1",
                    "start": 273,
                    "text": "[2,",
                    "end": 276
                },
                {
                    "type": "bibr",
                    "ref_id": "b5",
                    "start": 276,
                    "text": "6]",
                    "end": 278
                }
            ]
        },
        {
            "section": "Energy test",
            "text": "The distance function should be falling with increasing distance d ij between events i and j, in order to increase the sensitivity to local asymmetries. A Gaussian function is chosen, defined as \u03c8 ij \u2261 \u03c8(d ij ) = e \u2212d 2 ij /2\u03c3 2 with a tunable parameter \u03c3, which describes the effective radius in phase-space within which a local asymmetry is measured. Thus, this parameter should be larger than the resolution of d ij but small enough not to dilute locally varying asymmetries.",
            "paragraph_rank": 19,
            "section_rank": 5
        },
        {
            "section": "Energy test",
            "text": "The performance of the energy test method, based on one of the samples used in Fig. 1, is shown in Fig. 2. The sensitivity to the parameter \u03c3 is shown. The improved performance of this method over S CP in this case of a 3% asymmetry in amplitude is seen by comparing the figures; indeed, a 5% amplitude asymmetry results in p-values from the energy test below 10 \u221210 . Studies from the authors show this enhancement in sensitivity is common but not universal: cases have been found in three-body decays in which S CP showed better sensitivity than the energy test for optimal binning and CP violation in the amplitude or phase of some resonances. The uncertainty on the p-value in Fig obtained by randomly resampling the fit parameters within their uncertainties, taking into account their correlations, and by extracting a p-value for each of these generated T distributions. This uncertainty is found to arise mainly from the uncertainty on the width of the GEV function (Fig. 2). The sensitivity of the optimal \u03c3 to various parameters of a three-body decay model was studied. The value was found to be largely independent of the Dalitz plot structure or the width of the resonance in which CP violation was introduced. A variable \u03c3 set according to the density of points in the plot was also studied but not demonstrated to have any advantage over a fixed \u03c3. As trivially expected, the optimal \u03c3 is dependent quadratically on the mother particle mass in a three-body decay.",
            "paragraph_rank": 20,
            "section_rank": 5,
            "ref_spans": [
                {
                    "type": "figure",
                    "start": 79,
                    "text": "Fig. 1",
                    "end": 85
                },
                {
                    "type": "figure",
                    "ref_id": "fig_1",
                    "start": 99,
                    "text": "Fig. 2",
                    "end": 105
                },
                {
                    "type": "figure",
                    "start": 681,
                    "text": "Fig",
                    "end": 684
                },
                {
                    "type": "figure",
                    "ref_id": "fig_1",
                    "start": 973,
                    "text": "(Fig. 2)",
                    "end": 981
                }
            ]
        },
        {
            "text": "Presence of background",
            "section_rank": 6
        },
        {
            "section": "Presence of background",
            "text": "CP violation is expected to appear in relatively low rate decays where two amplitudes of similar magnitude interfere. The samples of signal events under study may be significantly polluted by additional background events from different physics processes that contribute at a similar rate to signal. Such pollution reduces the fraction of signal events (the purity) of the sample under study, and requires the use of additional techniques such that any significant effect can be associated with CP violation in the signal process.",
            "paragraph_rank": 21,
            "section_rank": 6
        },
        {
            "section": "Presence of background",
            "text": "The presence of background is problematic when studying local CP violation in the case that the purity is different in the two samples that are being compared. This can be generated, for example, through the presence of global production asymmetries between the two samples that are different for signal and background, even if no CP violation is present. Similarly problematic is the case where the background process itself exhibits CP violation. In these scenarios the local densities of events will differ between the two samples, since background populates the phase space differently to signal. For the binned S CP test different yields will be found in the phase space bins (even after normalising for the overall yield), and a significant effect could be inferred. The effect of background on the S CP test is typically removed by fitting the invariant mass distribution in each bin to determine the number of signal events in each bin, and then comparing these between the two samples. The energy test also exhibits similar complications. Differences in purity between the two samples are not reproduced when events are randomly assigned a flavour, since the purities and event densities will be consistent for the permuted samples; the densities of samples used in the permutation studies will not accurately model differences in density between the two 'real' data samples. Consequently background events can lead to significant T values and p-values being calculated even when the signal process exhibits no CP violation. It is therefore important to consider techniques to remove the effect of background from the energy test, so that any significant T value can be associated with CP violation in the studied decay. This section sets out such an approach.",
            "paragraph_rank": 22,
            "section_rank": 6
        },
        {
            "section": "Presence of background",
            "text": "The weighting of events to remove the effect of background was considered in Ref. [13]. Such weights give the relative purity of each sample in the particular region of phase-space that the event is drawn from. Therefore, when T is calculated two weights are used for each pair of events, with one weight for each event. This allows each pair of events to be weighted according to the relative number of pairs of signal events expected to contribute to the calculation of T from such locations within the phase space, and allows the estimation of the T value that would be found if only signal were present. However, this approach relies on knowledge of the signal density within the phase-space, which in many practical cases is not known.",
            "paragraph_rank": 23,
            "section_rank": 6,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b12",
                    "start": 82,
                    "text": "[13]",
                    "end": 86
                }
            ]
        },
        {
            "section": "Presence of background",
            "text": "An alternative method is suggested here to remove the bias introduced by background if additional representative samples of background events are available, for example from signal side-bands. This method will be equally applicable to other unbinned model independent two sample tests but is discussed here for the energy test. These additional samples will be labelled here as 'background samples', as opposed to the 'main samples' which are being explicitly tested for differences in local event densities. The events in the background samples can be used to subtract off the effect of signal and background event pairs, and background and background event pairs that arise when considering the T value set out in Eq. 2 when background is present in the main samples. This can be achieved by altering the test statistic to",
            "paragraph_rank": 24,
            "section_rank": 6
        },
        {
            "section": "Presence of background",
            "text": "where 2 is the inclusion here also of terms with j < i when the sums are over the same sample. This is balanced with an additional factor of 1 2 , and is included for simplicity when considering all terms. Assuming that the density of events in the background samples reflects the density of background events in the main samples (up to an overall normalisation factor), this T value provides an unbiased estimate of the T -value that would be calculated in the presence of signal alone.",
            "paragraph_rank": 25,
            "section_rank": 6
        },
        {
            "section": "Presence of background",
            "text": "An example of the effect of background on the energy test is shown in Fig. 3. Here, 4,000 signal events were generated (without CP violation) using the same model as in Ref. [13], and assigned a flavour randomly, with a 50% chance of each flavour. Background events were generated assuming no variation in event density across the 3-body phase space, with 1,600 events contaminating the main samples. Again, the flavour was assigned randomly, though on average 75% of events were assigned one flavour and 25% the other. An additional 1,600 events (with the same 3:1 asymmetry in flavour) were used to create additional background samples that could be used to remove any bias introduced by background in the main samples. This was performed 250 times, and in each trial the energy test was calculated using a \u03c3 parameter of 0.25. Such a scenario can generate large T -values if Eq. 2 is used to calculate the T -value, and the permutation method yields significant p-values. However, if the background samples are also considered, and Eq. 3 is used to remove the effects of background on average, an unbiased estimate of the T -value of signal events is recovered. This allows the use of the permutation method to estimate p values (using the same method to remove background from the randomly permuted samples), and allows any significant effect to be associated clearly with the signal channel. Therefore, for the rest of this article, the case where background is present is neglected. ",
            "paragraph_rank": 26,
            "section_rank": 6,
            "ref_spans": [
                {
                    "type": "figure",
                    "start": 70,
                    "text": "Fig. 3",
                    "end": 76
                },
                {
                    "type": "bibr",
                    "ref_id": "b12",
                    "start": 174,
                    "text": "[13]",
                    "end": 178
                }
            ]
        },
        {
            "text": "Coordinate selection",
            "section_rank": 7
        },
        {
            "section": "Coordinate selection",
            "text": "A decay of a pseudo-scalar particle M into n pseudo-scalar particles (A, B, C...) M \u2192 ABC...(n) can be described by n four-vectors p \u00b5 A , p \u00b5 B , p \u00b5 C ..., and consequently 4n parameters. The known masses of the identified final state particles A, B, C... remove n degrees of freedom. E,p conservation removes an additional four degrees of freedom. The system can be rotated freely around all spatial axes, removing a further three degrees of freedom. Hence, 3n \u2212 7 degrees of freedom remain. Consequently a three-body decay phase-space is fully described by the two variables conventionally used in Dalitz plot analyses. The phase-space of a four-body decay can be fully described by five parameters. The selection of the variables used to describe the phase-space is discussed in this section.",
            "paragraph_rank": 27,
            "section_rank": 7
        },
        {
            "text": "Distances in Phase-Space",
            "section_rank": 8
        },
        {
            "section": "Distances in Phase-Space",
            "text": "The S CP method requires the division of the decay phase-space into bins. The energy test method relies on the distance between events in the phase-space. The result of model-independent two-sample comparison tests will typically depend on the distance metric, not only the coordinates chosen.",
            "paragraph_rank": 28,
            "section_rank": 8
        },
        {
            "section": "Distances in Phase-Space",
            "text": "The distance between two points in phase-space in a three-body decay is usually measured as the Euclidean distance in the Dalitz plot. However, this distance depends on the choice of the axes of the Dalitz plot. This dependence can be removed by using all three invariant masses to determine the distance, d ij , calculated as the length of the displacement vector \u2206 x ij = (m 2,j 12 \u2212 m 2,i 12 , m 2,j 23 \u2212 m 2,i 23 , m 2,j 13 \u2212 m 2,i 13 ), where the 1, 2, 3 subscripts indicate the final-state particles. Using all three invariant masses does not add information, but it avoids an arbitrary choice that could impact the sensitivity of the method to different CP violation scenarios. This symmetrisation was applied in Ref. [22].",
            "paragraph_rank": 29,
            "section_rank": 8,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b21",
                    "start": 725,
                    "text": "[22]",
                    "end": 729
                }
            ]
        },
        {
            "section": "Distances in Phase-Space",
            "text": "In describing a four-body decay phase-space with invariant masses a mixture of two and three-body masses may be preferred, with no directly analogous symmetrisation, as discussed below.",
            "paragraph_rank": 30,
            "section_rank": 8
        },
        {
            "text": "Coordinates in four-body decays",
            "section_rank": 9
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "Four-body decays offer both challenges and opportunities with respect to three-body decays. A four-body decay phase-space is obviously more complicated and five coordinates are needed for its full description [23]. No unique choice of variables exists and depending on the decay dynamics and the purpose of the measurement one can try and optimize the set of coordinates.",
            "paragraph_rank": 31,
            "section_rank": 9,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b22",
                    "start": 209,
                    "text": "[23]",
                    "end": 213
                }
            ]
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "For cascade-type decays proceeding via resonances in a three-body subsystem and followed by two-body decays (e.g. D 0 \u2192 a 1 (1260) + (\u2192 \u03c1 0 (770)\u03c0 + )\u03c0 \u2212 ) a three-body invariant mass and a Dalitz-style distribution of the three-body decay would be a preferred option. For decays occurring through two two-body resonances, in particular ones with non-zero spins, (e.g. D 0 \u2192 \u03c1 0 (770)\u03c1 0 (770)) the natural choice is the so called transversity basis [24] comprising invariant masses of two-body subsystems, their helicity angles and the acoplanarity angle between decay planes of the two resonances. In some decays both decay types may contribute significantly (e.g. both of the examples given here contribute to D 0 \u2192 \u03c0 + \u03c0 \u2212 \u03c0 + \u03c0 \u2212 decays). The most general amplitude analysis that aims at a description of decay dynamics is performed in the phase-space constructed with the four-momenta of the final state particles and any coordinates are chosen only to illustrate the results.",
            "paragraph_rank": 32,
            "section_rank": 9,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b23",
                    "start": 450,
                    "text": "[24]",
                    "end": 454
                }
            ]
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "The energy test is a statistical method comparing the events distributions in phasespace (see Sect. 2). Therefore it is sensitive to the position of an event in phase-space and to the choice of coordinates building this phase-space. All choices are not equivalent in terms of the sensitivity of the analysis as it will change the distance between events in the phase-space.",
            "paragraph_rank": 33,
            "section_rank": 9
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "There are many possible choices for the variables to describe the degrees of freedom of the phase-space. A natural set of invariants is p i p j , or equivalently s ij defined as",
            "paragraph_rank": 34,
            "section_rank": 9
        },
        {
            "section": "Coordinates in four-body decays",
            "text": ". There are 1 2 n(n \u2212 1) such invariants; for four-body decays there are six of them.",
            "paragraph_rank": 35,
            "section_rank": 9
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "Three-body mass invariants, s ijk , can be made from linear combinations of the twobody invariants:",
            "paragraph_rank": 36,
            "section_rank": 9
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "k , so can be used interchangeably (for n > 3) for the s ij . While they carry the same information as s ij , the choice will change the distance measure between events used in the CP violation search. There are 1 3! n(n \u2212 1)(n \u2212 2) such invariants; there are four of them in four body decays. Consequently there are ten mass invariants, six two-body and four three-body, which can be used to characterise a four-body decay. We consider a physically motivated choice of the coordinates. Invariant mass combinations corresponding to 'unphysical' doubly-charged meson resonances may be excluded. A further reduction in coordinates can be made by  Table 1: Coordinates used, and those excluded, in the measurement of [2] and coordinates suggested for",
            "paragraph_rank": 37,
            "section_rank": 9,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b0",
                    "start": 212,
                    "text": "1",
                    "end": 213
                },
                {
                    "type": "table",
                    "start": 645,
                    "text": "Table 1",
                    "end": 652
                },
                {
                    "type": "bibr",
                    "ref_id": "b1",
                    "start": 714,
                    "text": "[2]",
                    "end": 717
                }
            ]
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "Excluding the mass marked in brackets would reduce to the minimal five coordinates that span the phase-space.",
            "paragraph_rank": 38,
            "section_rank": 9
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "excluding mass combinations with small resonance contributions. An additional complication in many decays of interest will be the presence of identical final state particles (e.g. D 0 \u2192 \u03c0 + \u03c0 \u2212 \u03c0 + \u03c0 \u2212 ). Identical particles of the same charge can be swapped; as a result in the example decay each event can be placed in four points in phase-space. The energy test is sensitive to such particle swapping as well. To get a unique output from the energy test, as well as to get optimal sensitivity, the order of the particles, i.e. the input variables of energy test need to be determined.",
            "paragraph_rank": 39,
            "section_rank": 9
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "Consider the experimentally interesting example of the singly Cabibbo suppressed D 0 \u2192 \u03c0 + \u03c0 \u2212 \u03c0 + \u03c0 \u2212 decay. The charge order of the particles in the D 0 decay \u03c0 1 \u03c0 2 \u03c0 3 \u03c0 4 is fixed to \u03c0 + \u03c0 \u2212 \u03c0 + \u03c0 \u2212 . For a D 0 decay, the order of \u03c0 1 \u03c0 2 \u03c0 3 \u03c0 4 is the C-conjugated one: \u03c0 \u2212 \u03c0 + \u03c0 \u2212 \u03c0 + . The invariant masses of all possible \u03c0 + \u03c0 \u2212 pairs are calculated and sorted for each event. Once the \u03c0 + \u03c0 \u2212 pair with the largest invariant mass is fixed to be \u03c0 3 \u03c0 4 , the order of all four pions is fully determined. As only a small fraction of the \u03c1(770) resonance, either produced directly from D 0 or through a 1 (1260) decays, contributes to the largest m(\u03c0 + \u03c0 \u2212 ), the \u03c0 3 \u03c0 4 combination is excluded [24]. Two-body masses except for the m(\u03c0 3 \u03c0 4 ) and three-body mass combinations that do not contain the \u03c0 3 \u03c0 4 are kept. In that way we end up with exactly five invariant masses, which contain most of the dominant resonance contributions, as listed in Table 1. This choice has been adopted in [2]. Simulation studies comparing the performance of the test with these five coordinates and with the eight 'physical' mass combinations have been performed. No significant difference in sensitivity was obtained, though the optimal sigma is larger when using eight coordinates.",
            "paragraph_rank": 40,
            "section_rank": 9,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b23",
                    "start": 707,
                    "text": "[24]",
                    "end": 711
                },
                {
                    "type": "table",
                    "start": 962,
                    "text": "Table 1",
                    "end": 969
                },
                {
                    "type": "bibr",
                    "ref_id": "b1",
                    "start": 1003,
                    "text": "[2]",
                    "end": 1006
                }
            ]
        },
        {
            "section": "Coordinates in four-body decays",
            "text": "The other singly Cabibbo suppressed D 0 decay with charged long-lived hadrons in the final state is D 0 \u2192 K + K \u2212 \u03c0 + \u03c0 \u2212 . In this case no significant three-body resonances containing K + K \u2212 are observed [25], and thus these masses can be excluded as coordinates. The other coordinates have significant contributions and thus for an energy test method of this final state a physically motivated choice would be to proceed with six coordinates, as shown in Table 1, or to reduce to five coordinates by further excluding the mass combination with the smallest resonance contribution (m 234 ).",
            "paragraph_rank": 41,
            "section_rank": 9,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b24",
                    "start": 206,
                    "text": "[25]",
                    "end": 210
                },
                {
                    "type": "table",
                    "start": 458,
                    "text": "Table 1",
                    "end": 465
                }
            ]
        },
        {
            "text": "Parity-even and Parity-odd CP Violation Tests",
            "section_rank": 10
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "The choice of only invariant masses as coordinates, as discussed in the previous section, has a limitation. Invariant masses, of both two-and three-body systems, can be expressed through the double product of particle momenta ( p a \u2022 p b ) and, as such, are even under the P -parity transformation (changing p into \u2212 p). Thus, invariant masses allow only P -even CP asymmetries to be probed. This is also true of helicity angles.",
            "paragraph_rank": 42,
            "section_rank": 10
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "In three-body decays only P -even amplitudes can be present and the conventional model-independent test of comparing particle and anti-particle samples is sufficient. In four-body decays P -odd amplitudes can be present and accessed with P -odd quantities. These are triple products of a general form p a \u2022 ( p b \u00d7 p c ); the acoplanarity angle between decay planes of two resonances is one example. There is a class of measurements based on the triple products, often called T -odd measurements 1 , which probe the P -odd type of CP asymmetry only [26].",
            "paragraph_rank": 43,
            "section_rank": 10,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b25",
                    "start": 549,
                    "text": "[26]",
                    "end": 553
                }
            ]
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "An asymmetry of this P -odd kind is induced by interferences between P -even and P -odd decay amplitudes, thus the sensitivity to CP violation depends on the P -odd amplitude contribution in the decay. However, it is proportional to the cosine of the strong-phase difference between the interfering partial waves [27] and thus will be enhanced where P -even CP asymmetry, proportional to sine of the strong-phase difference, lacks sensitivity.",
            "paragraph_rank": 44,
            "section_rank": 10,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b26",
                    "start": 313,
                    "text": "[27]",
                    "end": 317
                }
            ]
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "Consider again the general four-body decay M \u2192 ABCD and its antiparticle equivalent M . A triple product",
            "paragraph_rank": 45,
            "section_rank": 10
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "is constructed for M decays. The p A , p B and p C are vector momenta of particles A, B, C in the M centre-of-mass frame. The corresponding triple product for the M decays is obtained by applying the CP parity transformation, CP (C T ) = \u2212C(C T ) = \u2212C T . The C T is constructed with the anti-particles A, B, C, being the C-conjugations of the ones entering C T . The total sample may be divided into four subsamples according to the particle/antiparticle flavour and the triple product sign:",
            "paragraph_rank": 46,
            "section_rank": 10
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "The relationships between the samples under symmetry transformations is illustrated in Fig. 4 Consider the more familiar case of asymmetries, these may be measured in the C T regions using the number of events populating the four samples in Eq. 4:",
            "paragraph_rank": 47,
            "section_rank": 10,
            "ref_spans": [
                {
                    "type": "figure",
                    "ref_id": "fig_4",
                    "start": 87,
                    "text": "Fig. 4",
                    "end": 93
                }
            ]
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "In the absence of CP Violation both of the asymmetries are expected to be compatible with zero. CP asymmetries can be extracted from these samples that are P -even or P -odd (i.e. even and odd with respect to C T ) simply by adding or subtracting the asymmetries measured in the C T regions:",
            "paragraph_rank": 48,
            "section_rank": 10
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "The A P \u2212even CP test corresponds to integrating over C T , and is equivalent (within normalisation) to the default sample comparison test in which particle (samples [I] and [II]) and anti-particle samples (samples [III] and [IV]) are compared in the phase-space built with invariant masses only. A binned or unbinned comparison of the phase-spaces of the decays is then performed using techniques such as those described in Sect. 2.",
            "paragraph_rank": 49,
            "section_rank": 10
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "The A P \u2212odd CP from Eq. 6 is equivalent to the quantity measured in the T -odd analyses. The asymmetry is typically measured integrated over the whole phase-space or asymmetries can be measured in the phase-space regions [26].",
            "paragraph_rank": 50,
            "section_rank": 10,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b25",
                    "start": 222,
                    "text": "[26]",
                    "end": 226
                }
            ]
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "Unbinned model independent techniques do not allow for an asymmetry measurement. However, the P -odd CP asymmetry can be tested by comparing the combined sample I + IV with the combined sample II + III. This comparison may be performed in the same phase-space as the default P -even approach and allows the probing of the P -odd contribution into the CP asymmetry; the P -even contribution cancels out.",
            "paragraph_rank": 51,
            "section_rank": 10
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "In the case of four-body meson decays, P -odd amplitudes can contribute only if the intermediate-resonance configuration is V V , V T or T T (V and T stand for vector and tensor meson respectively) and if both resonances have helicities of either \u00b11 or \u00b12. For example, In the D 0 \u2192 \u03c0 + \u03c0 \u2212 \u03c0 + \u03c0 \u2212 decays there is one significant P -odd amplitude. It is the one describing perpendicular helicity (A \u22a5 ) of the D 0 \u2192 \u03c1 0 (770)\u03c1 0 (770) decays. Alternatively, in the partial wave basis, it is the amplitude corresponding to the P -wave D 0 \u2192 \u03c1 0 (770)\u03c1 0 (770) decays, meaning relative orbital momentum of the two \u03c1(770) mesons equal to 1. In such cases, the default approach may be extended to make a complementary test of the P -odd CP asymmetry.",
            "paragraph_rank": 52,
            "section_rank": 10
        },
        {
            "section": "Parity-even and Parity-odd CP Violation Tests",
            "text": "The complementarity of the P -even and P -odd CP violation tests can be illustrated in a simple simulation. Simulated data samples, containing one million D 0 \u2192 \u03c0 + \u03c0 \u2212 \u03c0 + \u03c0 \u2212 decays, are produced with MINT, a software package for amplitude analysis of multi-body decays that has also been used by the CLEO collaboration [25]. The amplitude model used is based on a preliminary version of that given in Ref. [28]. CP violation is introduced by changing the amplitude or phase of the P -wave D 0 \u2192 \u03c1 0 (770)\u03c1 0 (770) decays compared with the D 0 decays. Table 2 shows that clear sensitivity to the amplitude change is obtained in the P -even test and to the phase change in the P -odd test.  Table 2: p-values for D 0 \u2192 \u03c0 + \u03c0 \u2212 \u03c0 + \u03c0 \u2212 simulation samples with phase and amplitude CP asymmetries in D 0 \u2192 \u03c1 0 (770)\u03c1 0 (770)(P -wave) (see text). Results from both P -even and P -odd CP violation tests are given. The p-values are extracted from fits with a GEV function. The cells shaded in gray demonstrate sensitivity to the simulated CP violation scenarios.",
            "paragraph_rank": 53,
            "section_rank": 10,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b24",
                    "start": 322,
                    "text": "[25]",
                    "end": 326
                },
                {
                    "type": "bibr",
                    "ref_id": "b27",
                    "start": 409,
                    "text": "[28]",
                    "end": 413
                },
                {
                    "type": "table",
                    "start": 554,
                    "text": "Table 2",
                    "end": 561
                },
                {
                    "type": "table",
                    "start": 692,
                    "text": "Table 2",
                    "end": 699
                }
            ]
        },
        {
            "text": "Implementation of unbinned techniques",
            "section_rank": 11
        },
        {
            "section": "Implementation of unbinned techniques",
            "text": "The principal drawback of a number of unbinned statistical methods is the computational time required for large sample sizes. In methods, such as the energy test, that require the pairwise distance between all events in the sample to be calculated, the computational time grows quadratically with the sample size. Furthermore, in the energy test a significant number of permutations are required for the random comparison samples to get a sufficient precision on the probabilistic interpretation of the T value, for example to demonstrate that evidence (> 3\u03c3) for CP violation was observed over one thousand permutations would be needed. In probing CP violation in b-hadron decays the computational constraints are typically not a limitation in these methods currently. However, in multi-body decay channels of interest in charm physics data samples of order one million events are available at the LHCb experiment. At this sample size one permutation for the energy tests requires around one day of CPU time on a typical computing node. Consequently the generation of 1000 permutations would require significant computational resources. Even though modern multi-core CPUs have realised thread-level parallelism, the number of parallel threads is still very limited. This has been overcome in our studies by implementation on Graphical Processing Units (GPUs). A GPU is a specialised electronic circuit designed to rapidly manipulate and alter memory to accelerate the creation of images for output to a display. Their highly parallel structure makes them more efficient than CPUs for algorithms where large blocks of data are processed in parallel. Our implementation utilises the Compute Unified Device Architecture (CUDA) and Thrust library developed by NVIDIA [29]. The parallelisation is utilised for the calculation of the pairwise event distances. One permutation for one million events takes approximately 30 minutes to be computed on the two GPU systems utilised (NVIDIA M2070, NVIDIA K40c). Both manual and Grid submissions systems have been used. This implementation has made the energy test computationally feasible for the first time in CP violation searches with large data sets. The code of this implementation of the energy test, Manet, has been made available [30].",
            "paragraph_rank": 54,
            "section_rank": 11,
            "ref_spans": [
                {
                    "type": "bibr",
                    "ref_id": "b28",
                    "start": 1764,
                    "text": "[29]",
                    "end": 1768
                },
                {
                    "type": "bibr",
                    "ref_id": "b29",
                    "start": 2277,
                    "text": "[30]",
                    "end": 2281
                }
            ]
        },
        {
            "text": "Conclusions",
            "section_rank": 12
        },
        {
            "section": "Conclusions",
            "text": "The performance and optimisation of two techniques for model-independent searches for direct CP violation in multi-body decays is discussed. It is shown that binned comparisons are best performed with a smaller number of bins than has previously been used in some of the literature. The potential advantages of unbinned techniques are discussed and demonstrated, and an approach to account for the presence of background is suggested. An implementation of the unbinned energy test technique is provided on GPUs, which renders this method feasible for the largest data sample sizes currently available at experiments.",
            "paragraph_rank": 55,
            "section_rank": 12
        },
        {
            "section": "Conclusions",
            "text": "Considerations in the choice, and symmetrisation, of the coordinates used to describe the phase-space of three and four-body decays are discussed, with specific examples given. A novel method for analysing P -odd CP violation in multi-body decays in unbinned model independent searches is presented.",
            "paragraph_rank": 56,
            "section_rank": 12
        },
        {
            "text": "to observe local CP number of bins per axis",
            "paragraph_rank": 57,
            "section_rank": 13
        },
        {
            "text": "Figure 2 :",
            "section_rank": 14
        },
        {
            "section": "Figure 2 :",
            "text": "Figure 2: (top) T-values and (bottom) p-values versus \u03c3 in the energy test method for simulation samples with CP violation introduced at the 3% level in one amplitude (see text). The p-values are evaluated using 100 permutation samples where their distribution is fitted with a GEV function. The width of the GEV function and its uncertainty is also shown on the top plot. The yellow band on the lower plot shows the uncertainty on the p-value accounting for the uncertainties in the GEV fit, including the correlation of the fitted parameters.",
            "paragraph_rank": 58,
            "section_rank": 14
        },
        {
            "text": "w andw are the number of signal events in the main samples, and b andb are the number of background events in the main samples, while b s andb s denote the number of background events in the background samples. The additional terms in comparison with Eq. 2 sum over pairs of events in the background and main samples or sum over pairs of events in the background samples, removing on average the effects of pairs of background and signal events and pairs of background events, when calculating T . The other notable difference with Eq.",
            "paragraph_rank": 59,
            "section_rank": 15
        },
        {
            "text": "6 T calculated using Eq. 2 T calculated using Eq. 3 Figure 3 :",
            "section_rank": 16
        },
        {
            "section": "6 T calculated using Eq. 2 T calculated using Eq. 3 Figure 3 :",
            "text": "Figure 3: The T -value relative to the T -value found from only considering signal events (T signal ), when calculated using Eq. 2, where background is not removed, and Eq. 3, which subtracts (on average) the effect of background. The first case shows a clear bias; the presence of background can lead to small p-values when the permutation method is used to determine significance. The mean of the second distribution is consistent with zero, removing the bias associated with background.",
            "paragraph_rank": 60,
            "section_rank": 16
        },
        {
            "text": "Figure 4 :",
            "section_rank": 17
        },
        {
            "section": "Figure 4 :",
            "text": "Figure 4: Symmetry transformation relationships of the four data samples used in the CP violation tests.",
            "paragraph_rank": 61,
            "section_rank": 17
        },
        {
            "text": "Two-body masses Three-body masses Unphysical m 13 , m 24 Physical m 12 , m 14 , m 23 , m 34 m 123 , m 124 , m 134 , m 234 Selected m 12 , m 14 , m 23 m Physical m 12 , m 14 , m 23 , m 34 m 123 , m 124 , m 134 , m 234 Selected m 12 , m 14 , m 23 , m 34 m 134 , (m 234 )",
            "paragraph_rank": 62,
            "section_rank": 18
        },
        {
            "text": ". Samples [I] and [III] are related by CP transformation; and so are [II] and [IV]. There are thus two potential sample comparison tests for CP violation using the full data sample: comparing a sample consisting of data set [I] and [II] with a sample containing data [III] and [IV]; or comparing the combined [I]+[IV] with the combined [II]+[III]. Both tests span the full C T space.",
            "paragraph_rank": 63,
            "section_rank": 19
        },
        {
            "text": "Triple products are also odd under T -parity, although time reversal is not what is typically measured.",
            "paragraph_rank": 64,
            "section_rank": 19
        },
        {
            "text": "Acknowledgements",
            "section_rank": 21
        },
        {
            "section": "Acknowledgements",
            "text": "The authors wish to acknowledge the contributions to this work from the following MPhys and summer students at the University of Manchester over the past three years: William Fawcett, Constantin Weisser, Nicholas Bedford, Jezabel Boni, Samuel Dysch, Connor Graham. We wish to thank Samuel Harnew, Jonas Rademacker, Gediminas Sarpis, and Mike Williams for illuminating discussions. We thank Mike Sokoloff, Andrew McNab and Sabah Salih for their assistance with computing. GPU facilities at the University of Manchester and the Ohio Supercomputer centre have been utilised in this work. This work was supported by the STFC grant numbers ST/J004332/1, ST/K003410/1, and ST/N000374/1.",
            "paragraph_rank": 65,
            "section_rank": 21
        }
    ]
}